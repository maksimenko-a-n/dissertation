%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%     Расширенная аффинная сводимость
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Расширенная аффинная сводимость}
\label{chap:ExtAff}
%\begin{flushright}
%	А если немного ослабить условия?
%\end{flushright}
%\medskip

В этой главе рассматриваются следствия смягчения способа сравнения многогранников, используемого в предыдущей главе.
А именно, слова <<аффинно эквивалентен>> в определении~\ref{def:ineA} будут заменены на <<является аффинным образом>>. 
На основе такого способа сравнения многогранников в первом разделе главы вводится понятие расширенной аффинной сводимости семейств многогранников, выводятся некоторые его свойства и устанавливаются связи между этим понятием и другими определениями аффинной сводимости из главы~\ref{chap:AffTheory}.
Далее, в разделе~\ref{sec:ExtAffExamples} приводятся примеры расширенной аффинной сводимости. В~целом, благодаря ослаблению условий, доказательства соответствующих утверждений оказываются значительно более простыми, чем для (обычной) аффинной сводимости.
В последнем разделе главы показано, что любое семейство многогранников, предикат допустимости которого принадлежит классу NP, расширенно аффинно сводится к булевым квадратичным многогранникам.
Тем самым, все упоминаемые выше в настоящей работе семейства многогранников оказываются эквивалентны друг другу с точки зрения расширенной аффинной сводимости.

\section{Теория}
\label{sec:ExtensionTheory}

\begin{definition}\label{def:ineE}
	Если некоторая грань многогранника $Q$ или же весь этот многогранник является расширением многогранника $P$, 
	%В случае, когда многогранник $P$ является аффинным образом многогранника~$Q$ или же его грани, 
	будем использовать обозначение $P \lee Q$.
\end{definition}

%Заметим, прежде всего, что из $P \lea Q$ следует $P \lee Q$.
Некоторые следствия, вытекающие из соотношения $P \lee Q$, были описаны выше, в разделах \ref{sec:Extension} и \ref{sec:RectCover} (например, свойство~\ref{prop:xc-compare} и его аналог для числа прямоугольного покрытия матрицы инциденций вершин"=гиперграней). 

Замена $\lea$ на $\lee$ значительно расширяет возможности сравнения многогранников. Кроме того, во многих случаях доказательство соотношений вида $P \lee Q$ принципиально проще, чем соотношений $P \lea Q$.
Минусом такого ослабления ограничений является потеря некоторых полезных свойств.
В частности, пользуясь соотношением $P \lee Q$, вообще говоря, нельзя сравнивать числа фасет соответствующих многогранников и кликовые числа их графов.

Рассмотрим несколько простых примеров.

Ранее (см. с.~\pageref{ProjOfSimplex}) уже упоминался тот факт, что 
любой многогранник $P$, имеющий $n$ вершин, является аффинным образом симплекса $\Delta_{n-1}$. В частности, если $P$~--- $d$"~мерный 0/1"~многогранник, то
\(P \lee \Delta_{n}\), при $n \ge 2^d-1$.

%По аналогии с $d$-мерным 0/1-многогранником введем понятие $d$-мерного
%\emph{$[k]$-многогранника}, множество вершин которого принадлежит $[k]^d$.

Пусть $a,b \in Z$, $a < b$, и $[a,b]$~--- множество целых чисел соответствующего отрезка. Пусть $k = \lceil\log_2 (b-a+1)\rceil$, а функция $\zeta \from [a,b] \to \{0,1\}^k$ каждому целому $x \in [a,b]$ ставит в соответствие двоичную запись числа $x-a$. Очевидно, эта функция полиномиально вычислима. С другой стороны, обратное преобразование 
\begin{equation}
\label{eq:01toZ}
\zeta^{-1} \from \bm{y} \mapsto a + y_1 + 2 y_2 + \dots + 2^{k-1} y_k
\end{equation}
аффинно и тоже полиномиально вычислимо.
Как следствие, получаем следующее

\begin{prop}\label{prop:01}
Пусть $X \subseteq S^n$, где $S$~--- множество целых чисел некоторого отрезка $[a,b]$.
Тогда существует $Y \subseteq \{0,1\}^d$, $d = n \cdot \lceil\log_2 (b-a+1)\rceil$, что
\[
X \lee Y.
\]
\end{prop}

Иными словами, при некоторых, достаточно мягких ограничениях, многогранник с целочисленными вершинами является проекцией 0/1-многогранника.

По аналогии с аффинной сводимостью (определение \ref{def:Aff}) введем понятие расширенной аффинной сводимости на основе отношения $\lee$.
Предварительно напомним, что под размером многогранника подразумевается сумма длины его кода и размерности пространства.


\begin{definition}
	\label{def:Aff2}
	Будем говорить, что семейство многогранников $P$ \emph{расширенно аффинно сводится} к семейству многогранников $Q$, если найдутся полиномиально вычислимые (относительно размера многогранника $p\in P$):
	\begin{enumerate}
		\item 
		Преобразование $\tau$ кода $I$ каждого многогранника $p = p(I)\in P$ в код $I'$ многогранника $q = q(I') \in Q$.
		\item 
		Система линейных уравнений $D\bm{y}=\bm{c}$, задающая грань
		\(F = \Set{\bm{y}\in q \given D\bm{y}=\bm{c}}\)
		многогранника $q$.
		\item 
		Алгоритм построения для каждого кода $I$ аффинного отображения 
		\[
		\beta\from \R^{d'} \to \R^{d}, \qquad d = d(I), \quad d' = d'(\tau(I)),
		\]
		такого, что $p = \beta(F)$.
	\end{enumerate}
	Обозначение: $P \propto_E Q$.  
\end{definition}

\begin{lemma}
	Для любых двух семейств многогранников $P$ и $Q$ из $P \propto_A Q$ следует $P \propto_E Q$.
\end{lemma}
	
\begin{proof}
	В определении~\ref{def:Aff} требуется наличие биективного аффинного отображения $\alpha \from p \to F$,
	а в определении~\ref{def:Aff2}~--- наличие аффинного отображения $\beta \from F \to p$ и системы линейных уравнений, определяющих грань $F$.
	Если отображение биективно, то переход от одного способа описания к другому можно осуществить за полиномиальное время (см., например, \cite{Winkler:1996}).
\end{proof}

По аналогии с теоремой~\ref{thm:Aff2Cones} может быть доказана следующая связь этого типа сводимости с аффинной сводимостью линейных задач комбинаторной оптимизации.

\begin{theorem}
\label{thm:ExtAff2AffProblems}
Пусть линейная задача комбинаторной оптимизации $(d,S,g)$ определяет семейство многогранников $P = \{p(I)\}$, а задача $(d',S',g')$ "--- семейство многогранников $Q = \{q(I')\}$.
Предположим, что семейство $P$ расширенно аффинно сводится к $Q$ и, кроме того,
система уравнений $D\bm{y}=\bm{c}$, задающая грань соответствующего многогранника $q \in Q$, состоит из уравнений гиперплоскостей, опорных к $q$.
Тогда задача $(d,S,g)$ с ограничением $\bm{-1} \le \bm{c} \le \bm{1}$ аффинно сводится к задаче $(d',S',g')$.
\end{theorem}

Перечислим некоторые очевидные свойства этого типа сводимости,
вытекающие из свойств расширений, описанных в разделах \ref{sec:Extension} и \ref{sec:RectCover}. 

%\begin{prop}
%	Пусть $P \propto_E Q$. Тогда задача линейной оптимизации на многогранниках семейства $P$ полиномиально сводится к задаче линейной оптимизации на многогранниках семейства $Q$.
%\end{prop}
	
\begin{prop}
	\label{thm:PropE}
	Пусть $P \propto_E Q$.
	Предположим, что в семействе $P$ есть многогранники, имеющие одно или несколько из следующих свойств:
	\begin{enumerate}
		\item Cверхполиномиальность числа вершин (относительно размера многогранника).
		\item Cверхполиномиальное число прямоугольного покрытия.
		\item Cверхполиномиальная сложность расширения.
	\end{enumerate}
	\noindent
	Тогда в $Q$ имеются многогранники с теми же свойствами.
\end{prop}

По аналогии с утверждением \ref{prop:01} легко доказать следующую теорему.

\begin{theorem}[об универсальности 0/1-многогранников]
%\sloppy
	Пусть семейство комбинаторных многогранников $P$ определяется четверкой $(L,d,k,g)$ (см. определение~\ref{def:family}).
	Тогда $P$ расширенно аффинно сводится к семейству комбинаторных 0/1"=многогранников,
	определяемых четверкой $(L,d',1,f)$, где $d' = d\cdot\lceil\log_2(k+1)\rceil$,
	$f = f(\bm{y}, I) = g(\gamma(\bm{y}), I)$, $\bm{y} \in \{0,1\}^{d'}$,
	а $\gamma$~--- линейная проекция, определяемая по аналогии с формулой~\eqref{eq:01toZ}.
\end{theorem}

Этот факт хорошо известен, и многие исследователи осознанно ограничиваются изучением семейств 0/1-многогранников~\cite{Junger:1995,Papadimitriou:1984}.

%Определение. Пусть функция $d = d(n)$ полиномиальна, а последовательность конечных множеств $X_n \in \Z^d$ такова, что для любых $n \in \N$ и $x \in \Z^d$ задача проверки принадлежности $x \in X_n$ принадлежит классу NP. Тогда семейство (последовательность) многогранников $P(n) = \conv(X_n)$ называется \emph{комбинаторным}.

%Примечание. В~\cite{Naddef:1981, MatsuiTamura:1995} комбинаторными называются многогранники, у которых для каждой пары несмежных вершин середина соединяющего их отрезка является также серединой отрезка, соединяющего (некоторую) другую пару вершин этого многогранника.

Оказывается, универсальность семейства комбинаторных 0/1"=многогранников допускает более широкую трактовку.

\begin{theorem}
	\label{thm:NP2comb}
	Пусть четверка $(L,d,k,g)$ определяет некоторое семейство многогранников $P$,
	а предикат допустимости $g$ принадлежит классу NP.
	Тогда это семейство расширенно аффинно сводится к некоторому семейству комбинаторных многогранников $Q$.
\end{theorem}
\begin{proof}
Пусть $g = g(\bm{x},I)$ принадлежит классу NP.
Тогда, согласно определению~\ref{def:NP}, существует полином $p\from\N\to\N$ и полиномиально вычислимый предикат $f\from \{0,1\}^* \to \{\text{ложь},\text{истина}\}$ такие, что 
\[
g(\bm{x},I) \iff \text{найдется } \bm{u}\in \{0,1\}^{p(d+\size(I))} 
\text{ такой, что } f(\bm{x}, \bm{u}, I).
\]

С помощью предиката $f$ определим многогранники
\[
q(I) = \Set*{(\bm{x}, \bm{u}) \in \{0,1,\dots,k\}^d \times \{0,1\}^{p(d+\size(I))} \given f(\bm{x}, \bm{u}, I)}
\]
некоторого комбинаторного семейства многогранников $Q = \{q(I)\}$. 
Остается заметить, что многогранник 
\[
p(I) = \Set*{\bm{x}\in\{0,1,\dots,k\}^d \given g(\bm{x},I)}
\]
является ортогональной проекцией многогранника $q(I)$.
\end{proof}

Примером семейства многогранников с NP-полным предикатом допустимости могут служить многогранники гамильтоновых графов $\Ham(n)$ (см. определение на с.~\pageref{def:HamPolytope}).

В заключение этого раздела покажем, что соотношение $P \lee Q$ в некоторых случаях можно использовать для сравнения кликовых чисел графов многогранников $P$ и $Q$.

\begin{theorem}
Пусть многогранник $P \subseteq \R^d$ является образом многогранника $Q \subseteq \R^n$ при ортогональном проецировании $\pi \from \R^n \to \R^d$, $n > d$.
Пусть, кроме того, $\pi(\ext Q) = \ext P$.
Тогда граф многогранника $P$ является подграфом графа многогранника $Q$.
\end{theorem}

\begin{proof}
Для каждой вершины $\bm{v} \in \ext P$ определим множество
\[
W(\bm{v}) = \Set*{\bm{x} \in \ext Q \given \pi(\bm{x}) = \bm{v}}.
\]
Очевидно, $\conv (W(\bm{v}))$ является гранью многогранника $Q$.
Более того, если множество $V \subseteq \ext P$ является множеством вершин некоторой грани многогранника $P$, то $\conv \Set{W(\bm{v})\given v\in V}$~--- грань многогранника $Q$.

Для удобства полагаем, что $\R^d$ вложено в $\R^n$,
а проецирование $\pi$ преобразует $(x_1, \dots, x_d, \dots, x_n)$ в $(x_1, \dots, x_d, 0, \dots, 0)$.
Вспомогательный вектор $\bm{c} \in \R^n$ определим следующим образом.
Если $n = d+1$, то $\bm{c} = \bm{e_n}$,
иначе $\bm{c} = \lambda_{d+1} \bm{e_{d+1}} + \dots + \lambda_{n} \bm{e_n}$
и коэффициенты $\lambda_{d+1}$, \dots, $\lambda_{n}$ подобраны так, 
что для любого $\bm{v} \in \ext P$ и любых двух вершин $\bm{w}, \bm{w'} \in W(\bm{v})$ из неравенства $\bm{w} \ne \bm{w'}$ следует $\bm{c}^T \bm{w} \ne \bm{c}^T \bm{w'}$.
Ясно, что в силу конечности множества вершин многогранника $Q$ такой вектор $\bm{c}$ существует. 
С помощью этого вектора в каждом множестве $W(\bm{v})$ выделим уникальную вершину
\[
\bm{w_v} = \argmax_{\bm{w} \in W(\bm{v})} \Set{\bm{c}^T \bm{w}}.
\]

Остается показать, что если вершины $\bm{v_1}$ и $\bm{v_2}$ многогранника $P$ смежны, то соответствующие вершины 
$\bm{w_1} = \bm{w_{v_1}}$ и $\bm{w_2} = \bm{w_{v_2}}$ тоже смежны.

Предположим, что вершины $\bm{v_1}$ и $\bm{v_2}$ многогранника $P$ смежны.
Тогда многогранники $F_1 = \conv (W(\bm{v_1}))$ и $F_2 = \conv (W(\bm{v_2}))$, а также их выпуклая оболочка $F = \conv(F_1 \cup F_2)$ являются гранями многогранника $Q$.

Положим $\bm{b} = \bm{v_2} - \bm{v_1}$.
Тогда $\bm{b}^T \bm{w} = \bm{b}^T \bm{w'}$ для любых $\bm{w}, \bm{w'} \in F_1$.
Аналогично, $\bm{b}^T \bm{w} = \bm{b}^T \bm{w'}$ для любых $\bm{w}, \bm{w'} \in F_2$.
Кроме того, $\bm{b}^T \bm{w_1} \neq \bm{b}^T \bm{w_2}$.
%Причем $\aff(F_1)$ и $\aff(F_2)$ ортогональны вектору 
%(Соответственно, линейная функция $\bm{b}^T \bm{x}$ принимает разные значения для $\bm{w_1}$ и $\bm{w_2}$.)

Подберем числа $\beta, \gamma \in \R$, $\gamma > 0$, так,
чтобы линейная функция $f(\bm{x}) = \beta \bm{b}^T \bm{x} + \gamma \bm{c}^T \bm{x}$ принимала одинаковые значения для $\bm{w_1}$ и $\bm{w_2}$.
Тогда из определения вектора $\bm{c}$ и вершин $\bm{w_1}$ и $\bm{w_2}$ следует
\[
f(\bm{w_1}) = f(\bm{w_2}) > f(\bm{w}) \quad
%\text{для всех } 
\forall
\bm{w} \in W(\bm{v_1}) \cup W(\bm{v_2}) \setminus \{\bm{w_1}, \bm{w_2}\}.
\]
Следовательно, $\bm{w_1}$ и $\bm{w_2}$~--- смежные вершины многогранника $F = \conv(W(\bm{v_1}) \cup W(\bm{v_2}))$, являющегося гранью многогранника $Q$.
\end{proof}

\begin{corollary}
\label{cor:CliqueOfExtension}
Пусть многогранник $P \subseteq \R^d$ является образом многогранника $Q \subseteq \R^n$ при аффинном отображении $\pi \from \R^n \to \R^d$.
Пусть, кроме того, $\pi(\ext Q) = \ext P$.
Тогда кликовые числа графов этих многогранников связаны соотношением $\omega(P) \le \omega(Q)$.
\end{corollary}

Особо отметим, что все известные автору настоящей работы естественные примеры расширенной аффинной сводимости (в том числе и перечисленные в этой главе) удовлетворяют условиям этого следствия.
%В первую очередь этот феномен объясняется тем, что в основном речь идет о семействах 0/1-многогранников.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%     Примеры
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Примеры}
\label{sec:ExtAffExamples}

По причине существенного ослабления условий, факты расширенной аффинной сводимости встречаются в литературе гораздо чаще, чем факты аффинной сводимости.
Перечислим несколько известных примеров:
\begin{enumerate}
	\item Перестановочный многогранник $\Perm(n)$ является линейной проекцией многогранника Биркгофа: $\Perm(n) \lee \Birk(n)$ (см. с.~\pageref{Perm2Birk}).
	%	\item Многогранники совершенных паросочетаний являются многогранниками упаковок множества: $\Match \propto_A \Pack$.
	\item Связь между многогранниками гамильтоновых циклов и многогранниками гамильтоновых контуров упоминалась в разделе~\ref{sec:Travelling}:
	$\TSP(n) \lee \ATSP(n)$.
	\item Многогранник совершенных паросочетаний $\Match(2n)$ является проекцией многогранника гамильтоновых циклов~\cite{Yannakakis:1991}: $\Match(2n) \lee \TSP(6n)$.
	\item Для любого графа $G=(V,E)$, $\Stable(G) \lee \ATSP(k)$, где $k = 4 |E| + |V|$~\cite{Yannakakis:1991}.
	\item Для каждого $n\in \N$ существует граф $G = (V,E)$, $|V| = 2n^2$, такой, что $\BQP(n) \lee \Stable(G)$~\cite{FioriniPokutta:2015} (см. также теорему \ref{thm:BQPStable}).
	\item Многогранник задачи о 3-выполнимости $\SAT(U,C)$ является проекцией грани многогранника трехиндексной аксиальной задачи о назначениях~\cite{AvisTiwary:2015}: $\SAT(U,C) \lee \TAP(m)$, где $m = O(kn)$, $k=|U|$, $n=|C|$. Причем аффинная сводимость $\SAT \propto_A \TAP$ невозможна (см. раздел~\ref{sec:3Ass}).
	\item Для любого графа $G=(V,E)$ существует планарный кубический граф $G'=(V',E')$, $|V'| = O(|E|^2)$, $|E'| = O(|E|^2)$, что $\Stable(G) \lee \Stable(G')$~\cite{AvisTiwary:2015}.
	\item Нетрудно заметить, что $\Stable(G) \lee \BQP(n)$ для любого графа $G = ([n],E)$. (Соответствующая грань многогранника $\BQP(n)$ лежит в пересечении гиперплоскостей $x_{ij} = 0$, $\{i,j\} \in E$.) В то же время,	если граф $G$ неполный, то соотношение $\Stable(G) \lea \BQP(n)$ невозможно ни при каком $n$ (см. утверждение~\ref{prop:StableBQP}).
\end{enumerate}

Ряд следующих утверждений призван продемонстрировать типичные способы доказательства фактов расширенной аффинной сводимости. 

%Тот факт, что семейство многогранников задачи о рюкзаке с равенством аффинно сводится к семейству многогранников задачи о рюкзаке, очевиден (см. определения и комментарии на с.~\pageref{eq:KnapEq})

Начнем с того, что семейство многогранников задачи о рюкзаке расширенно аффинно сводится к семейству многогранников задачи о рюкзаке с равенством
(см. определение на с.~\pageref{eq:KnapEq}).

\begin{lemma}
	Пусть $n \in \N$, $\bm{a}=(a_1,\dots,a_n) \in \Z^n$ и $b \in \Z$.
	Положим 
	\[
	S_{\min} = \begin{cases}
	0,& \text{если }  \bm{a} \ge \bm{0},\\
	\sum\limits_{i:\ a_i < 0} a_i,& \text{иначе,} 
	\end{cases}
	\]
	$M = \max\{1, b - S_{\min}\}$ и 
	\[
	\bm{c} = (a_1, \dots, a_n, 1, 2, \dots, 2^k), \quad \text{где }
	k = \lceil\log_2 (M)\rceil.
	\]
	Тогда
	$\Knap(\bm{a},b) \lee \KnapEq(\bm{c},b)$.
\end{lemma}

\begin{lemma}
	Для любых $n \in \N$, $\bm{a} \in \Z^n$ и $b \in \Z$ выполнено
	$\KnapEq(\bm{a},b) \lee \BQP(n)$.
\end{lemma}
\begin{proof}
Уравнение $\bm{a}^T \bm{x} = b$ из определения многогранника задачи о рюкзаке с равенством (см. формулу~\eqref{eq:KnapEq}) заменим на
\(
(\bm{a}^T \bm{x} - b)^2 = 0,
\)
или, что то же самое,
\[
\sum_i 2 b a_i x_i - \sum_{i,j} a_i a_j x_i x_j = b^2.
\]
Очевидно, уравнение 
\[
\sum_i 2 b a_i y_{ii} - \sum_{i,j} a_i a_j y_{ij} = b^2, \quad \text{где }
\bm{y} =(y_{ij}) \in \R^{n(n+1)/2},
\]
определяет опорную гиперплоскость к многограннику $\BQP(n)$.
С другой стороны, отображение $y_{ii} \mapsto x_i$, $i\in[n]$, проецирует соответствующую грань многогранника $\BQP(n)$ на многогранник $\KnapEq(\bm{a},b)$.
\end{proof}

\begin{lemma}[\cite{Maksimenko:2013TSP}]
$\ATSP(n) \lee \BQP\left((n-1)^2\right)$. 
\end{lemma}
\begin{proof}
Координаты вектора $\bm{y} \in \BQP\left((n-1)^2\right)$ обозначим $y(ij,kl)$, где $i,j,k,l \in [n-1]$, $i \le k$ и если $i = k$, то $j \le l$.
Согласно определению булева квадратичного многогранника (см. формулу \eqref{eq:BQP}), $y(ij,kl) = y(ij,ij) y(kl,kl)$.

Очевидно, уравнения 
\[
y(ij,il) = 0, \qquad i,j,l \in [n-1], \quad j < l,
\]
задают некоторую грань $F_1$ этого многогранника.
Из этого следует
\[
\sum_{j\in[n-1]} y(ij,ij) \le 1, \qquad i \in [n-1], \text{ для всех }\bm{y}\in F_1.
\]
Положив 
\begin{equation}
\label{eq:ATSP2BQP1}
\sum_{j\in[n-1]} y(ij,ij) = 1, \qquad i \in [n-1],
\end{equation}
перейдем к рассмотрению грани $F_2 \subseteq F_1$.

Аналогично, уравнения
\[
y(ij,kj) = 0, \qquad i,j,k \in [n-1], \quad i < k,
\]
и
\begin{equation}
\label{eq:ATSP2BQP2}
\sum_{i\in[n-1]} y(ij,ij) = 1, \qquad j \in [n-1],
\end{equation}
задают некоторую грань $F_3 \subseteq F_2$ многогранника $\BQP\left((n-1)^2\right)$.

Таким образом, для каждого $\bm{y} \in F_3$,
согласно уравнениям \eqref{eq:ATSP2BQP1} и \eqref{eq:ATSP2BQP2},  
координаты $y(ij,ij)$, $i,j\in[n-1]$, образуют квадратную 0/1"~матрицу,
у которой в каждой строке и каждом столбце имеется ровно одна единица.
В частности, проекция грани $F_3$ на переменные $y(ij,ij)$, $i,j\in[n-1]$, совпадает с многогранником Биркгофа $\Birk(n-1)$.

Для $\bm{x} \in \ATSP(n)$ положим
\begin{align*}
x_{n,j} &= y(1\,j, 1\,j),     & j&\in[n-1],\\
x_{j,n} &= y(n-1\,j, n-1\,j), & j&\in[n-1],\\
x_{j,l} &= \sum_{i\in[n-2]} y(i\,j, i+1\,l), & j,l&\in[n-1], \ j\neq l.
\end{align*}
Нетрудно проверить, что это линейное отображение проецирует $F_3$ на $\ATSP(n)$.
\end{proof}


\begin{lemma}[\cite{Maksimenko:2017LOP}]
	$\Stable(G) \lee \LOP(2n)$ для любого графа $G = (V,E)$, $|V|=n$.
\end{lemma}
\begin{proof}
	Рассмотрим грань $F$ многогранника $\LOP(2n)$, лежащую в пересечении опорных гиперплоскостей $x_{i, n+j} = x_{j, n+i} = 0$, $\{i,j\} \in E$, $i < j$.
	Тогда из 3-контурных неравенств (см.~\eqref{3cycle})
	\[
	0 \le x_{i, j} + x_{j, n+i} - x_{i, n+i} \quad \text{и} \quad
	x_{i, j} + x_{j, n+j} - x_{i, n+j} \le 1
	\]
	следует $x_{i, n+i} + x_{j, n+j} \le 1$, $\{i,j\} \in E$.
	То есть отображение $\alpha\from x_{i, n+i} \mapsto y_i$ проецирует грань $F$ в многогранник $\Stable(G)$.
	
	Остается показать, что для каждого $\bm{y} \in \Stable(G)$ найдется $\bm{x} \in F$ такой, что $\bm{y} = \alpha(\bm{x})$.
	
	Выберем произвольно $\bm{y} \in \Stable(G)$ и положим
	\[
	I_0 = \Set*{i \in [n] \given y_i = 0}, \quad I_1 = \Set*{i \in [n] \given y_i = 1}.
	\]
	Далее предполагаем, что элементы множеств $I_0 = \{i_1, \dots, i_k\}$ и $I_1 = \{i'_1, \dots, i'_{n-k}\}$ отсортированы (не важно как).
	Линейный порядок для соответствующей вершины $\bm{x} \in F$ представим перестановкой $\pi \from [n] \to [n]$ (см. условие \eqref{eq:piLinear}).
	Положим
	\begin{align*}
	\pi(n+i_s) &= s, &
	\pi(i_s) &= 2n-k + s, & s &\in [k],\\
	\pi(n+i'_t) &= n + t, &
	\pi(i'_t) &= k + t, & t &\in [n-k].
	\end{align*}
	Из описания перестановки $\pi$ следует, что 
	$x_{i_s, n+i_s} = 0$,  при $s \in [k]$, а
	$x_{i'_t, n+i'_t} = 1$, при $t \in [n-k]$.
	Причем, если $x_{i, n+j} = 1$ для некоторых $i,j \in [n]$, то $x_{i, n+i} = x_{j, n+j} = 1$.
	То есть из условия $x_{i, n+i} + x_{j, n+j} \le 1$ следует $x_{i, n+j} = x_{j, n+i} = 0$.
\end{proof}

Справедливость следующего утверждения очевидна.

\begin{lemma}
Пусть в семействе многогранников $P$ множество вершин каждого многогранника вычисляется (генерируется) за полиномиальное относительно размера многогранника время.
%, а число вершин ограничено сверху полиномом от размерности (числа координат).
Тогда $P$ расширенно аффинно сводится к семейству симплексов $\Delta$. (Кодом симплекса является множество его вершин.)
\end{lemma}
%\begin{proof}
%\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%     Теорема Кука
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Аналог теоремы Кука для многогранников}
\label{sec:Cook4Polytopes}

Пусть $C$~--- булева формула в конъюнктивной нормальной форме (см. определение на с.~\pageref{def:CNF}).
Обозначим через $\var(C)$ число переменных, участвующих в этой формуле.
Через $C(\bm{x})$ обозначим значение, возвращаемое этой формулой для набора значений переменных $\bm{x} \in \{0,1\}^{\var(C)}$.
Для множества всех таких булевых формул введем обозначение CNF.

Согласно теореме Кука~\cite{Cook:1971}, для любого языка $L \subseteq \{0,1\}^*$ из класса NP существует полиномиально вычислимое относительно $n\in\N$ преобразование $T = T(n)$, $T(n) \in \text{CNF}$, такое, что для всех $n\in\N$ выполнено $\var(T(n)) \ge n$, а для каждого $\bm{x} \in \{0,1\}^n$ справедливо %$\var(T_n) \ge n$ и 
\[
\bm{x}\in L  \iff \text{найдется }\bm{y}\in\{0,1\}^{\var(T)-n} \text{ такой, что } T(\bm{x},\bm{y}),
\]
где $T(\bm{x},\bm{y})$~--- значение, возвращаемое булевой формулой $T$ при подстановке набора значений переменных $(\bm{x},\bm{y})$.

Доказательство следующей теоремы полностью аналогично доказательству теоремы~\ref{thm:NP2comb}.

\begin{theorem}
Пусть четверка $(L,d,k,g)$ определяет некоторое семейство многогранников $P$,
а предикат допустимости $g$ принадлежит классу NP.
Тогда это семейство расширенно аффинно сводится к семейству многогранников задачи о выполнимости $\SAT$.
\end{theorem}

В частности, все упоминаемые выше в настоящей работе семейства многогранников удовлетворяют условиям этой теоремы.

В предыдущей главе было показано, что булевы квадратичные многогранники аффинно сводятся к многим известным семействам многогранников, ассоциированным с NP-трудными задачами.
Покажем теперь, что все эти семейства расширенно аффинно сводятся к $\BQP$.

\begin{theorem}[\cite{Maksimenko:2012Cook}]
\label{thm:SAT2BQP}
Пусть $U$ "--- набор булевых переменных, $\cC$ "--- набор дизъюнкций над $U$, $\len(\cC)$ "--- суммарная длина всех дизъюнкций из набора $\cC$, измеряемая в литералах.
Тогда \(\SAT(U,\cC) \lee \BQP(n)\), где $n = |U| + \len(\cC)$.
\end{theorem}

%\emph{Доказательство.}
\begin{proof}
Воспользуемся алгоритмом сведения задачи о выполнимости к задаче о клике из фундаментальной работы Карпа~\cite{Karp:1972}.

Вместо множества $[n]$ для индексации координат $x_{ij}$ вектора $\bm{x} \in \BQP(n)$ будем пользоваться множеством
\[
R = U \cup \Set*{(a, C_i) \given C_i \in \cC, \ \text{ $a$ "--- литерал, входящий в $C_i$}}.
\]
Соответственно, координаты вектора $\bm{x} \in \BQP(n)$ обозначаем $x(r, r')$, $r, r' \in R$.
В~частности, $x(r, r') = x(r, r) x(r', r')$ для всех $\bm{x} \in \BQP(n)$.

Рассмотрим подмножество вершин $F$ многогранника $\BQP(n)$, удовлетворяющих следующим ограничениям:
\begin{align}
x\bigl((u,C_i), (u,C_i)\bigr) &\le x\bigl(u,u\bigr), && C_i \in \cC, \quad u \in C_i, \label{eq:SAT2BQP1}\\
x\bigl(u,u\bigr) \cdot x\bigl((\bar{u},C_i), (\bar{u},C_i)\bigr) &= 0, && C_i \in \cC, \quad \bar{u} \in C_i, \label{eq:SAT2BQP2}\\
x\bigl((u,C_i), (u,C_i)\bigr) \cdot x\bigl((\bar{u},C_j), (\bar{u},C_j)\bigr) &= 0, && C_i, C_j \in \cC, \quad u \in C_i, \quad \bar{u} \in C_j, \label{eq:SAT2BQP3}\\
\sum_{a\in C_i} x\bigl((a,C_i), (a,C_i)\bigr) &= 1, && C_i \in \cC. \label{eq:SAT2BQP4}
\end{align}
Заметим, что $F$ является гранью многогранника $\BQP(n)$ (точнее, $\conv(F)$ является гранью $\conv(\BQP(n))$), так как каждое из этих ограничений эквивалентно принадлежности к некоторой опорной гиперплоскости. А именно, неравенство~\eqref{eq:SAT2BQP1} соответствует опорной гиперплоскости $x\bigl((u,C_i), (u,C_i)\bigr) = x\bigl(u,(u,C_i)\bigr)$, ограничение~\eqref{eq:SAT2BQP2} соответствует опорной гиперплоскости $x\bigl(u,(\bar{u},C_i)\bigr) = 0$, а~\eqref{eq:SAT2BQP3} соответствует $x\bigl((u,C_i), (\bar{u},C_j)\bigr) = 0$.
В свою очередь, уравнение~\eqref{eq:SAT2BQP4} определяется гиперплоскостью
\[
\sum_{a\in C_i} x\bigl((a,C_i), (a,C_i)\bigr) - 2 \sum_{\substack{a,b\in C_i,\\ a \ne b}} x\bigl((a,C_i), (b,C_i)\bigr) = 1.
\]

Обозначая координаты вектора $\bm{y} \in \SAT(U,\cC)$ через $y(u)$, $u\in U$,
рассмотрим аффинное отображение $\beta\from x(u,u) \mapsto y(u)$, проецирующее грань $F$ на $\SAT(U,\cC)$.
Включение $\beta(F) \subseteq \SAT(U,\cC)$ следует из того, что любой $\bm{x} \in \BQP(n)$, удовлетворяющий ограничениям \eqref{eq:SAT2BQP1}--\eqref{eq:SAT2BQP4}, соответствует некоторому набору значений переменных $U$, выполняющему каждую дизъюнкцию из $\cC$.
Обратное включение следует из того, что для любого набора значений переменных $U$, выполняющего $\cC$, несложно построить пример вектора $\bm{x} \in F$, координаты $x(u,u)$ которого принимают значения соответствующих переменных.
\end{proof}

\begin{corollary}
\label{cor:SAT2BQP}
Пусть четверка $(L,d,k,g)$ определяет некоторое семейство многогранников $P$, а предикат допустимости $g$ принадлежит классу NP. Тогда это семейство расширенно аффинно сводится к семейству булевых квадратичных многогранников.
\end{corollary}

%Аналог теоремы Кука для многогранников~\cite{Maksimenko:2012} цитируется в работах~\cite{Seliverstov,Beasley:2013,Fiorini:2014,Huq:2016}. В диссертации~\cite{Huq:2016} этот результат назван теоремой Максименко. 

В~\cite{Beasley:2013} замечено, что из теоремы~\ref{thm:SAT2BQP} и результата S.~Burer~\cite{Burer:2009} следует, что любой 0/1-многогранник, чье множество вершин может быть описано полиномиальным предикатом, имеет коположительное расширение\footnote{Коположительное расширение многогранника $P$ "--- это пересечение аффинного подпространства и коположительного конуса $C_n = \{X \mid y^T X y \ge 0, \ \forall y \in \R_{+}^n\}$ такое, что $P$ является его проекцией. Двойственным к коположительному конусу является полностью положительный конус $C^*_n = \{X \mid X = \sum_{y \in Y} y y^T \text{ для некоторого конечного } Y \subset \R_{+}^n\}$, с которым связано понятие полностью положительного расширения.} полиномиального размера. 
А в~\cite{Fiorini:2014} теорема~\ref{thm:SAT2BQP} используется для того, чтобы дать ответ на следующий вопрос из работы S.~Burer~\cite{Burer:2009}: <<Кроме нескольких перечисленных задач, какие типы задач могут быть представлены как коположительные программы или полностью положительные программы?>> (\foreignlanguage{english}{``Other than the handful of problems listed above, what types of problems can be represented as COPs or as CPPs?''}).
