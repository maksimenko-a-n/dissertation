%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%     Расширенная аффинная сводимость
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Расширенная аффинная сводимость}
\begin{flushright}
	А если немного ослабить условия?
\end{flushright}

\section{Определения и примеры}

В этой главе рассматриваются следствия смягчения способа сравнения многогранников, используемого в предыдущей главе.
% (см. определение \ref{def:ineA})
А именно, слова <<аффинно эквивалентен>> в определении~\ref{def:ineA} будут заменены на <<является аффинным образом>>. 

\begin{definition}\label{def:ineE}
	Если некоторая грань многогранника $Q$ или же весь этот многогранник является расширением многогранника $P$, 
	%В случае, когда многогранник $P$ является аффинным образом многогранника~$Q$ или же его грани, 
	будем использовать обозначение $P \lee Q$.
\end{definition}

%Заметим, прежде всего, что из $P \lea Q$ следует $P \lee Q$.
Ряд следствий, вытекающих из соотношения $P \lee Q$, был описан выше, в разделах \ref{sec:Extension} и \ref{sec:RectCover}.

Замена $\lea$ на $\lee$ значительно расширяет возможности сравнения многогранников. Кроме того, во многих случаях доказательство соотношений вида $P \lee Q$ принципиально проще, чем соотношений $P \lea Q$.
Минусом такого ослабления ограничений является потеря некоторых полезных свойств.
В частности, пользуясь соотношением $P \lee Q$, вообще говоря, нельзя сравнивать числа фасет соответствующих многогранников и кликовые числа их графов.

Рассмотрим несколько простых примеров.

Ранее (см. с.~\pageref{ProjOfSimplex}) уже упоминался тот факт, что 
любой многогранник $P$, имеющий $n$ вершин, является аффинным образом симплекса $\Delta_{n-1}$. В частности, если $P$~--- $d$"~мерный 0/1"~многогранник, то
\[
P \lee \Delta_{n}, \quad \text{при }  n \ge 2^d-1.
\]

%По аналогии с $d$-мерным 0/1-многогранником введем понятие $d$-мерного
%\emph{$[k]$-многогранника}, множество вершин которого принадлежит $[k]^d$.

Пусть $a,b \in Z$, $a < b$, и $[a,b]$~--- множество целых чисел соответствующего отрезка. Пусть функция $\zeta \from [a,b] \to \{0,1\}^k$, где $k = \lceil\log_2 (b-a+1)\rceil$, каждому целому $x \in [a,b]$ ставит в соответствие двоичную запись числа $x-a$. Очевидно, эта функция полиномиально вычислима. С другой стороны, обратное преобразование 
\begin{equation}
\label{eq:01toZ}
\zeta^{-1} \from \bm{y} \mapsto a + y_1 + 2 y_2 + \dots + 2^{k-1} y_k
\end{equation}
аффинно и тоже полиномиально вычислимо.
Как следствие, получаем следующее

\begin{prop}\label{prop:01}
Пусть $X \subseteq S^n$, где $S$~--- множество целых чисел некоторого отрезка $[a,b]$.
Тогда существует $Y \subseteq \{0,1\}^d$, $d = n \cdot \lceil\log_2 (b-a+1)\rceil$, что
\[
X \lee Y.
\]
\end{prop}

По аналогии с аффинной сводимостью (определение \ref{def:Aff}) введем понятие расширенной аффинной сводимости на основе отношения $\lee$.
Предварительно напомним, что под размером многогранника подразумевается сумма длины его кода и размерности пространства.


\begin{definition}
	\label{def:Aff2}
	Будем говорить, что семейство многогранников $P$ \emph{расширенно аффинно сводится} к семейству многогранников $Q$, если для каждого многогранника $p\in P$ найдется многогранник $q\in Q$, система линейных уравнений $D\bm{y}=\bm{c}$, задающая грань
	\[
	F = \Set{\bm{y}\in q \given D\bm{y}=\bm{c}},
	\]
	и аффинное отображение $\beta$, задаваемое системой 
	\[
	\bm{x} = B\bm{y} + \bm{a}, \qquad \bm{x} \in p, \quad \bm{y} \in F, 
	\]
	такие, что:
	\begin{enumerate}
		\item $p = \beta(F)$.
%		\item Размерность пространства, в котором определен многогранник $q$, ограничена сверху полиномом от размерности пространства для $p$.
		\item Размер многогранника $q$ ограничен сверху полиномом от размера многогранника $p$.
		\item Коэффициенты %аффинного отображения $\alpha$
		матриц $D$, $B$ и векторов $\bm{c}$, $\bm{a}$ 
		вычисляются за полиномиальное время относительно размера многогранника $p$.
	\end{enumerate}
	Обозначение: $P \propto_E Q$.  
\end{definition}

%\begin{remark}\end{remark}

\begin{lemma}
	Для любых двух семейств многогранников $P$ и $Q$ из $P \propto_A Q$ следует $P \propto_E Q$.
\end{lemma}
	
\begin{proof}
	В определении~\ref{def:Aff} требуется наличие биективного аффинного отображения $\alpha \from p \to F$,
	а в определении~\ref{def:Aff2}~--- наличие аффинного отображения $\beta \from F \to p$ и системы линейных уравнений, определяющих грань $F$.
	Если отображение биективно, то переход от одного способа описания к другому можно осуществить за полиномиальное время (см., например, \cite{Winkler:1996}).
\end{proof}

Перечислим некоторые очевидные свойства этого типа сводимости,
вытекающие из свойств расширений, описанных в разделах \ref{sec:Extension} и \ref{sec:RectCover}. 

\begin{theorem}
	Пусть $P \propto_E Q$. Тогда задача линейной оптимизации на многогранниках семейства $P$ полиномиально сводится к задаче линейной оптимизации на многогранниках семейства $Q$.
\end{theorem}
	
\begin{theorem}
	\label{thm:PropE}
	Пусть $P \propto_E Q$.
	Предположим, что в семействе $P$ есть многогранники, имеющие одно или несколько из следующих свойств:
	\begin{enumerate}
		\item Cверхполиномиальность числа вершин (относительно размера многогранника).
		\item Cверхполиномиальное число прямоугольного покрытия.
		\item Cверхполиномиальная сложность расширения.
	\end{enumerate}
	\noindent
	Тогда в $Q$ имеются многогранники с теми же свойствами.
\end{theorem}

По аналогии с утверждением \ref{prop:01} легко доказать следующую теорему.

\begin{theorem}(об универсальности 0/1-многогранников)
	Пусть четверка $(L,d,k,g)$ определяет некоторое семейство комбинаторных многогранников $P$ (см. определение~\ref{def:family}).
	Тогда $P$ расширенно аффинно сводится к семейству комбинаторных 0/1"=многогранников,
	определяемых четверкой $(L,d',1,f)$, где $d' = d\cdot\lceil\log_2(k+1)\rceil$,
	$f = f(\bm{y}, I) = g(\gamma(\bm{y}), I)$, $\bm{y} \in \{0,1\}^{d'}$,
	а $\gamma$~--- линейная проекция, определяемая по аналогии с формулой~\eqref{eq:01toZ}.
\end{theorem}

Этот факт хорошо известен, и многие исследователи осознанно ограничиваются изучением семейств 0/1-многогранников~\cite{Junger:1995,Papadimitriou:1984}.

%Определение. Пусть функция $d = d(n)$ полиномиальна, а последовательность конечных множеств $X_n \in \Z^d$ такова, что для любых $n \in \N$ и $x \in \Z^d$ задача проверки принадлежности $x \in X_n$ принадлежит классу NP. Тогда семейство (последовательность) многогранников $P(n) = \conv(X_n)$ называется \emph{комбинаторным}.

%Примечание. В~\cite{Naddef:1981, MatsuiTamura:1995} комбинаторными называются многогранники, у которых для каждой пары несмежных вершин середина соединяющего их отрезка является также серединой отрезка, соединяющего (некоторую) другую пару вершин этого многогранника.

Оказывается, универсальность семейства комбинаторных 0/1"=многогранников допускает более широкую трактовку.

\begin{theorem}
	Пусть четверка $(L,d,k,g)$ определяет некоторое семейство многогранников $P$,
	а предикат допустимости $g$ принадлежит классу NP.
	Тогда это семейство расширенно аффинно сводится к некоторому семейству комбинаторных многогранников $Q$.
\end{theorem}
\begin{proof}
Пусть $g = g(\bm{x},I)$ принадлежит классу NP.
Тогда, согласно определению~\ref{def:NP}, существует полином $p\from\N\to\N$ и полиномиально вычислимый предикат $f\from \{0,1\}^* \times \{0,1\}^* \to \{\text{ложь},\text{истина}\}$ такие, что 
\[
g(\bm{x},I) \iff \text{найдется } \bm{u}\in \{0,1\}^{p(d+\size(I))} 
\text{ такой, что } f(\bm{x}, \bm{u}, I).
\]

С помощью предиката $f$ определим многогранники
\[
q(I) = \Set*{(\bm{x}, \bm{u}) \in \{0,1,\dots,k\}^d \times \{0,1\}^{p(d+\size(I))} \given f(\bm{x}, \bm{u}, I)}
\]
некоторого комбинаторного семейства многогранников $Q = \{q(I)\}$. 
Остается заметить, что многогранник 
\[
p(I) = \Set*{\bm{x}\in\{0,1,\dots,k\}^d \given g(\bm{x},I)}
\]
является ортогональной проекцией многогранника $q(I)$.
\end{proof}

Примером семейства многогранников с NP-полным предикатом допустимости могут служить многогранники гамильтоновых графов $\Ham(n)$ (см. определение на с.~\pageref{def:HamPolytope}).

В заключение этого раздела покажем, что соотношение $P \lee Q$ в некоторых случаях можно использовать для сравнения кликовых чисел графов многогранников $P$ и $Q$.

\begin{theorem}
Пусть многогранник $P \subseteq \R^d$ является образом многогранника $Q \subseteq \R^n$ при ортогональном проецировании $\pi \from \R^n \to \R^d$, $n > d$.
Пусть, кроме того, $\pi(\ext Q) = \ext P$.
Тогда граф многогранника $P$ является подграфом графа многогранника $Q$.
\end{theorem}

\begin{proof}
Для каждой вершины $\bm{v} \in \ext P$ определим множество
\[
W(\bm{v}) = \Set*{\bm{x} \in \ext Q \given \pi(\bm{x}) = \bm{v}}.
\]
Очевидно, $\conv (W(\bm{v}))$ является гранью многогранника $Q$.

Для удобства полагаем, что $\R^d$ вложено в $\R^n$,
а проецирование $\pi$ преобразует $(x_1, \dots, x_n)$ в $(x_1, \dots, x_d, 0, \dots, 0)$.
Вспомогательный вектор $\bm{c} \in \R^n$ определим следующим образом.
Если $n = d+1$, то $\bm{c} = \bm{e_n}$,
иначе $\bm{c} = \lambda_{d+1} \bm{e_{d+1}} + \dots + \lambda_{n} \bm{e_n}$
и коэффициенты $\lambda_{d+1}$, \dots, $\lambda_{n}$ подобраны так, 
что для любого $\bm{v} \in \ext P$ и любых двух вершин $\bm{w_1}, \bm{w_2} \in W(\bm{v})$ из неравенства $\bm{w_1} \ne \bm{w_2}$ следует $\bm{c}^T \bm{w_1} \ne \bm{c}^T \bm{w_2}$.
Ясно, что в силу конечности множества вершин многогранника $Q$ такой вектор $\bm{c}$ существует. 
С помощью этого вектора в каждом множестве $W(\bm{v})$ выделим уникальную вершину
\[
\bm{w_v} = \argmax_{\bm{w} \in W(\bm{v})} \Set{\bm{c}^T \bm{w}}.
\]

Остается показать, что если вершины $\bm{v_1}$ и $\bm{v_2}$ многогранника $P$ смежны, то соответствующие вершины 
$\bm{w_1} = \bm{w_{v_1}}$ и $\bm{w_2} = \bm{w_{v_2}}$ тоже смежны.

Предположим, что вершины $\bm{v_1}$ и $\bm{v_2}$ многогранника $P$ смежны.
Тогда многогранники $F_1 = \conv (W(\bm{v_1}))$ и $F_2 = \conv (W(\bm{v_2}))$, а также их выпуклая оболочка $F = \conv(F_1 \cup F_2)$ являются гранями многогранника $Q$.
Причем $\aff(F_1)$ и $\aff(F_2)$ ортогональны вектору $\bm{b} = \bm{v_2} - \bm{v_1}$.
(Соответственно, линейная функция $\bm{b}^T \bm{x}$ принимает разные значения для $\bm{w_1}$ и $\bm{w_2}$.)
Подберем числа $\beta, \gamma \in \R$, $\gamma > 0$, так,
чтобы линейная функция $f(\bm{x}) = \beta \bm{b}^T \bm{x} + \gamma \bm{c}^T \bm{x}$ принимала одинаковые значения для $\bm{w_1}$ и $\bm{w_2}$.
Нетрудно проверить, что тогда 
\[
f(\bm{w_1}) = f(\bm{w_2}) > f(\bm{w}) \quad
\text{для всех }
\bm{w} \in W(\bm{v_1}) \cup W(\bm{v_2}) \setminus \{\bm{w_1}, \bm{w_2}\}.
\]
Следовательно, $\bm{w_1}$ и $\bm{w_2}$ смежны.
\end{proof}

\begin{corollary}
Пусть многогранник $P \subseteq \R^d$ является образом многогранника $Q \subseteq \R^n$ при аффинном отображении $\pi \from \R^n \to \R^d$.
Пусть, кроме того, $\pi(\ext Q) = \ext P$.
Тогда $\omega(P) \le \omega(Q)$.
\end{corollary}

Особо отметим, что все известные автору настоящей работы естественные примеры расширенной аффинной сводимости (в том числе и перечисленные в этой главе) удовлетворяют условиям этого следствия.
%В первую очередь этот феномен объясняется тем, что в основном речь идет о семействах 0/1-многогранников.

\section{Примеры}


По причине существенного ослабления условий, факты расширенной аффинной сводимости встречаются в литературе гораздо чаще, чем факты аффинной сводимости.
Перечислим несколько примеров:
\begin{enumerate}
	\item Перестановочный многогранник $\Perm(n)$ является линейной проекцией многогранника Биркгофа: $\Perm(n) \lee \Birk(n)$ (см. с.~\pageref{Perm2Birk}).
	%	\item Многогранники совершенных паросочетаний являются многогранниками упаковок множества: $\Match \propto_A \Pack$.
	\item Связь между многогранниками гамильтоновых циклов и многогранниками гамильтоновых контуров упоминалась в разделе~\ref{sec:Travelling}:
	$\TSP(n) \lee \ATSP(n)$.
	\item Многогранник совершенных паросочетаний $\Match(2n)$ является проекцией многогранника гамильтоновых циклов~\cite{Yannakakis:1991}: $\Match(2n) \lee \TSP(6n)$.
	\item Для любого графа $G=(V,E)$, $\Stable(G) \lee \ATSP(k)$, где $k = 4 |E| + |V|$~\cite{Yannakakis:1991}.
	\item Для каждого $n\in \N$ существует граф $G = (V,E)$, $|V| = 2n^2$, такой, что $\BQP(n) \lee \Stable(G)$~\cite{FioriniPokutta:2015} (см. также теорему \ref{thm:BQPStable}).
	\item Многогранник задачи о 3-выполнимости $\SAT(U,C)$ является проекцией грани многогранника трехиндексной аксиальной задачи о назначениях~\cite{AvisTiwary:2015}: $\SAT(U,C) \lee \TAP(m)$, где $m = O(kn)$, $k=|U|$, $n=|C|$. Причем аффинная сводимость $\SAT \propto_A \TAP$ невозможна (см. раздел~\ref{sec:3Ass}).
	\item Для любого графа $G=(V,E)$ существует планарный кубический граф $G'=(V',E')$, $|V'| = O(|E|^2)$, $|E'| = O(|E|^2)$, что $\Stable(G) \lee \Stable(G')$~\cite{AvisTiwary:2015}.
	\item Нетрудно заметить, что для любого графа $G = (V,E)$ выполнено $\Stable(G) \lee \BQP(|V|)$. В то же время,	если граф $G$ неполный, то соотношение $\Stable(G) \lea \BQP(n)$ невозможно ни при каком $n$ (см. утверждение~\ref{prop:StableBQP}).
	\item Для любого графа $G = (V,E)$ легко доказывается соотношение $\Stable(G) \lee \LOP(2n)$, $n = |V|$.
	Достаточно рассмотреть грань $F$ многогранника $\LOP(2n)$, лежащую в пересечении гиперплоскостей $x_{n+j, i} = x_{n+i, j} = 1$, $\{i,j\} \in E$, и линейное отображение $x_{i, n+i} \mapsto y_i$ проецирующее $F$ на $\Stable(G)$.
	\item Пусть в семействе многогранников $P$ множество вершин каждого многогранника вычисляется (генерируется) за полиномиальное относительно кода многогранника время, а число вершин ограничено сверху полиномом от размерности (числа координат). Тогда $P$ расширенно аффинно сводится к семейству симплексов $\Delta$. (Кодом симплекса является множество его вершин.)
\end{enumerate}



\section{Теорема Кука для многогранников}

Пусть $C$~--- булева формула в конъюнктивной нормальной форме (см. определение на с.~\pageref{def:CNF}).
Обозначим через $\var(C)$ число переменных, участвующих в этой формуле.
Через $C(\bm{x})$ обозначим значение, возвращаемое этой формулой для набора значений переменных $\bm{x} \in \{0,1\}^{\var(C)}$.
Для множества всех таких булевых формул введем обозначение CNF.

Согласно теореме Кука~\cite{Cook:1971}, для любого языка $L \subseteq \{0,1\}^*$ из класса NP существует полиномиально вычислимое относительно $n\in\N$ преобразование $T = T(n)$, $T(n) \in \text{CNF}$, такое, что для всех $n\in\N$ выполнено $\var(T(n)) \ge n$, а для каждого $\bm{x} \in \{0,1\}^n$ справедливо %$\var(T_n) \ge n$ и 
\[
\bm{x}\in L  \iff \text{найдется }\bm{y}\in\{0,1\}^{\var(T)-n} \text{ такой, что } T(\bm{x},\bm{y})=1.
\]
