%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%     Аффинная сводимость
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Циклические многогранники}

\hfill
\begin{minipage}{0.5\textwidth}
Циклические многогранники обладают максимальным числом граней среди всех выпуклых многогранников той же размерности и с таким же числом вершин.
\begin{flushright}
Peter McMullen
\end{flushright}
\end{minipage}

\section{Определение и свойства}

В этом разделе приводится определение циклических многогранников и перечисляются их некоторые свойства.
Более подробную информацию о циклических многогранниках можно найти в~\cite{Grunbaum:2003} и~\cite{ZieglerBook}.

Пусть $T = \{t_1, \dots, t_n\} \subset \R$, $t_1 < t_2 < \dots < t_n$.
Зафиксируем $d \in \N$, $2 \le d < n$, и введем обозначение
\[
\bm{x}(i) \coloneq (t^{\phantom{1}}_i, t^2_i, \dots, t^d_i) \in \R^d, \qquad i\in[n]. 
\]
Сформулируем определение циклического многогранника (см. с.~\pageref{page:cyclic}) с использованием новых обозначений.
\emph{Циклическим многогранником} называется выпуклая оболочка множества
\[
\CP_d(T) \coloneq \{\bm{x}(1), \dots, \bm{x}(n)\}.
\]
Причем $\CP_d(T)$ "--- множество вершин этого многогранника.
Число $i\in[n]$ будем называть \emph{номером} вершины $\bm{x}(i)$.

\begin{theorem}[условие четности Гейла~\cite{Gale:1963}]
Многогранник $\CP_d(T)$ симплициален, то есть каждая его гипергрань содержит ровно $d$ вершин. Причем подмножество вершин с номерами из $S \subset [n]$, $|S|=d$, образует гипергрань тогда и только тогда, когда выполнено <<условие четности>>:
\[
\text{мощность множества } [k_1, k_2]\cap S \text{ четна для всех } k_1, k_2 \in [n] \setminus S, \ k_1 < k_2.
\]
\end{theorem}

Для $n=7$ примерами множеств, удовлетворяющих условию четности, могут служить
$\{1,5,6\}$, $\{1,7\}$, $\{2,3,4,5\}$ и $\{1,2,4,5,7\}$.
Таким образом, множество $S \subset [n]$, удовлетворяющее условию четности, однозначно разбивается на пары вида $\{i,i+1\}$ и, быть может, элементы $1$ и $n$.

Доказательство справедливости условия четности Гейла опирается на следующие факты:
\begin{enumerate}
\item Для любого $\bm{a} \in \R^d$ значения линейной функции $g(\bm{x}) = \bm{a}^T \bm{x}$ в точках $\bm{x}(i)$, $i\in[n]$, множества $\CP_d(T)$ совпадают со значениями многочлена $f(t) = a_1 t + a_2 t^2 + \dots + a_d t^d$ в точках $t_i$. То есть уравнение вида $f(t) = b$ задает гиперплоскость $\bm{a}^T \bm{x} = b$.
\item Многочлен вида 
\begin{equation}
\label{eq:CyclicPol}
f(t) = (t - t_1)(t_n - t) \prod_{i \in I} \bigl((t - t_i)(t - t_{i+1})\bigr), \quad I\subset [n],
\end{equation}
принимает нулевые значения в точках $t_1$, $t_n$, $t_i$, $t_{i+1}$, $i\in I$, и положительные значения в остальных точках из $T$.
\end{enumerate}
Таким образом, для каждого множества, удовлетворяющего условию четности, можно построить многочлен вида~\eqref{eq:CyclicPol}, определяющий гиперплоскость $f(t) = 0$, опорную для $\CP_d(T)$.


\section{Компактная расширенная формулировка}

Пусть, как и прежде, $T = \{t_1, \dots, t_n\} \subset \R$, $t_1 < t_2 < \dots < t_n$, $d \in \N$, $2 \le d < n$.
В этом разделе мы ограничиваемся рассмотрением только тех случаев, когда $t_{i+1} = t_i + 1$ для всех $i\in[n-1]$, и будем пользоваться более подходящим обозначением
\[
\CP_{d,n}(t_1) \coloneq \CP_d(T).
\]


\subsection{Случай $d=2$}

Заметим, что многогранники $\CP_{d,n}(t)$ и $\CP_{d,n}(s)$ аффинно изоморфны для любых $t,s \in \R$. 
А именно, из бинома $(t + (s-t))^i = \sum_{j=0}^i \binom{i}{j} (s-t)^{i-j} t^j$ получаем следующее аффинное отображение, определяющее изоморфизм между $\CP_{d,n}(t)$ и $\CP_{d,n}(s)$:
\begin{equation}\label{eq:affine_isomorphism} 
y_i:=(s-t)^i+\sum_{j=1}^i \binom{i}{j} (s-t)^{i-j} x_j, 
\end{equation}
где $(x_1,\ldots,x_d) \in \CP_{d,n}(t)$, $(y_1,\ldots,y_d) \in \CP_{d,n}(s)$.

Согласно только что сделанному замечанию, мы будем пользоваться кратким обозначением $\CP_{d,n}$ в тех случаях, когда выбор начального значения не влияет на результат рассуждений.


\begin{lemma}\label{lem:two_dim}
$\xc(\CP_{2,n}(t)) \le 2\lfloor \log_2(n-1)\rfloor+2$, где $n \ge 3$ и $t \in \R$.
\end{lemma}

\begin{proof}
Согласно~\eqref{eq:affine_isomorphism}, многогранник~$\CP_{2,n}(t)$ можно аффинно преобразовать в многогранник
\[
\CP_{2,n}(-(n-1)/2).
\] 
	
В свою очередь, для каждого $k\in\N$ многогранник~$\CP_{2,2k+1}(-k)$ может быть представлен как выпуклая оболочка двух многогранников $\CP_{2,k+1}(-k)$ и~$\CP_{2,k+1}(0)$:
%
\[
\CP_{2,2k+1}(-k) = \conv(\CP_{2,k+1}(-k) \cup \CP_{2,k+1}(0)).
\]
Аналогичное представление существует и для многогранника $\CP_{2,2k}(-k + 1/2)$:
\[
\CP_{2,2k}(-k + 1/2) = \conv(\CP_{2,k}(-k + 1/2) \cup \CP_{2,k}(1/2)), \quad k\in\N.
\]
	
Воспользуемся тем, что многогранник $\CP_{2,k+1}(-k)$ является образом многогранника $\CP_{2,k+1}(0)$ при зеркальном отражении относительно гиперплоскости $x_1 = 0$ (отображение определяется сменой знака первой координаты). То же верно и в отношении $\CP_{2,k}(-k + 1/2)$ и $\CP_{2,k}(1/2)$.

Этот факт позволяет на основе свойства зеркальной симметрии (см. Theorem~2 в~\cite{KaibelPashkovich:2013}) и~\eqref{eq:affine_isomorphism} сделать вывод о том, что каждая расширенная формулировка размера $h$ для многогранника $\CP_{2, \lceil n/2 \rceil}$ определяет расширенную формулировку размера $(h+2)$ для $\CP_{2,n}$. В частности, расширенная формулировка для $\CP_{2,2k+1}(-k)$ может быть такой:
\[
\CP_{2,2k+1}(-k)=\Set*{(x_1,x_2)\in\R^2 \given \text{найдется } z_1, \text{ что }(z_1,x_2)\in \CP_{2,k+1}(0) \text{ и } -z_1 \le x_1\le z_1}\,.
\]
Таким образом, $\xc(\CP_{2k+1}) \le \xc(\CP_{k+1}) + 2$ и $\xc(\CP_{2k}) \le \xc(\CP_{k}) + 2$.
	
Неравенство $\xc(\CP_{2,n}) \le 2 \lfloor \log_2(n-1) \rfloor + 2$ легко проверяется для $n = 3,4,5$. 
Следовательно, для завершения доказательства достаточно воспользоваться неравенствами
\[
\xc(\CP_{2,2k}) \le \xc(\CP_{2,k}) + 2 \le  2 \lfloor \log_2(k-1) \rfloor + 4 =2 \lfloor \log_2 (2k-2) \rfloor + 2
\]
и
\[\xc(\CP_{2,2k-1}) \le \xc(\CP_{2,k}) + 2 \le 2 \lfloor \log_2(k-1) \rfloor + 4 = 2 \lfloor \log_2 \big((2k-1) - 1\big) \rfloor + 2\,.
\]
Таким образом,
\[
\xc(\CP_{2,n}) \le  2\lfloor \log_2(n-1)\rfloor+2
\]
для всех $n\ge 3$.
\end{proof}

\begin{remark}
Более аккуратный разбор финальной части доказательства леммы~\ref{lem:two_dim}
позволяет улучшить верхнюю оценку сложности расширения до 
\[
\xc(\CP_{2,n}) \le 2\lfloor \log_2(n-1)\rfloor + 1 + \delta_n,
\]
где $\delta_n = 0$, если $2^k < n \le 3 \cdot 2^{k-1}$ для некоторого $k\in \N$, и $\delta_n = 1$ в остальных случаях.
\end{remark}


\subsection{Случай $d \ge 3$}

К сожалению, при $d \ge 3$ взаимосвязь между многогранниками $\CP_{d,k+1}(-k)$ и~$\CP_{d,k+1}(0)$ не так проста: многогранник $\CP_{d,k+1}(-k)$ является образом~$\CP_{d,k+1}(0)$ при смене знака координат с нечетным индексом. Это не соответствует симметрии относительно гиперплоскости и, следовательно, мы не можем воспользоваться свойствами зеркальной симметрии. 

Однако, мы можем воспользоваться теоремой Яннакакиса (теорема~\ref{thm:Yannakakis} на с.~\pageref{thm:Yannakakis})
и низкоранговой неотрицательной факторизацией матрицы невязок (см. определения~\ref{def:slack} и~\ref{def:nonneg}) многогранника~$P_{2,n}$, гарантируемой Леммой~\ref{lem:two_dim}. 

Строки матрицы невязок $M_{d,n}$ многогранника $\CP_{d,n}(t)$ будем индексировать элементами из $[n]$, а столбцы "--- множествами $S \subset [n]$, $|S|=d$, удовлетворяющими условию четности Гейла.
Согласно приведенным выше рассуждениям (см. формулу~\eqref{eq:CyclicPol} и комментарии к ней), эта матрица может быть представлена как
%
\begin{equation}
\label{eq:slack}
M_{d,n}(i,S) := \prod_{j \in S} |t_j - t_i|\,,
\end{equation}
%
где $i\in[n]$ и $S\subseteq [n]$, $|S|=d$, удовлетворяет условию четности Гейла.
В частности, матрица невязок не зависит от начального параметра $t$ в определении многогранника $\CP_{d,n}(t)$, так как он не меняет разности $t_j - t_i$. 

Перечислим некоторые очевидные свойства неотрицательного ранга матрицы.

\begin{property}\label{prop:nonneg}
Следующие операции над строками (столбцами) матрицы не увеличивают ее неотрицательный ранг:
\begin{enumerate}
	\item Перестановка строк (столбцов).
	\item Дублирование строки (столбца).
	\item Удаление строки (столбца).
	\item Умножение строки (столбца) на неотрицательное число.
	\item Добавление в матрицу новой строки (столбца), равной(ого) конической комбинации строк (столбцов).
\end{enumerate}
\end{property}

\begin{property}\label{prop:nonnegsum}
Пусть $M \in \R_+^{m\times n}$ и $S\subseteq[n]$. Пусть $M_1$ "--- подматрица матрицы $M$, составленная из столбцов с номерами из $S$, а $M_2$ "--- подматрица, составленная из столбцов с номерами из $[n]\setminus S$.
Тогда
\[
\rank_+(M) \le \rank_+(M_1) + \rank_+(M_2).
\]
\end{property}

Для двух матриц $A$ и $B$ одинакового размера, определим поэлементное произведение $A \circ B$ с помощью уравнения $(A \circ B)(i,j):=A(i,j) B(i,j)$. Кроме перечисленных выше свойств нам понадобится следующий фольклорный факт. 

\begin{lemma}
\label{lem:Kronecker}
Для любых двух матриц $A$ и $B$ с одинаковым числом строк и столбцов,
\[
\rank_+(A \circ B) \le \rank_+(A) \rank_+(B).
\]
\end{lemma}
%
\begin{proof}
Пусть $A,B \in \R_+^{n\times m}$ и
\begin{align*}
A &= TU, && \text{где }T\in \R_+^{n\times r}, \quad U\in \R_+^{r\times m},\\
B &= HW, && \text{где }H\in \R_+^{n\times s}, \quad W\in \R_+^{s\times m}.
\end{align*}
Через $M_i$ будем обозначать $i$-ю строку матрицы $M$, а через $M^j$ "--- $j$-ый столбец.
Строки $C_i$, $i\in[n]$, матрицы $C \in \R_+^{n \times rs}$ определим тензорным произведением
\[
C_i = T_i\otimes H_i,
\]
а столбцы $D^j$, $j\in[m]$, матрицы $D \in \R_+^{rs \times m}$ "--- произведением
\[
D^j = U^j\otimes W^j.
\]
Тогда
\[
A\circ B = CD.
\]
\end{proof}

Перейдем непосредственно к доказательству основного утверждения этого раздела.
Прежде всего рассмотрим четную размерность, положив~$d = 2q$, $q\in \N$.

\begin{lemma}
\label{lem:even_case}
$\xc(\CP_{2q, n}) \le \big(\xc(\CP_{2, n})\big)^q$ при $q,n\in\N$, $2q < n$.
\end{lemma}

\begin{proof}
Мы построим $q$ матриц $C_1$, \dots, $C_q$ таких, что поэлементное произведение $C_1 \circ \cdots \circ C_q$ равно матрице невязок $M_{2q, n}$. 
С этой целью заметим, что каждое множество $S\subseteq[n]$, $|S|=2q$, удовлетворяющее условию четности Гейла, может быть разбито на $q$ пар $S_1$, \dots, $S_q$, где каждая пара либо равна $\{1,n\}$, либо состоит из двух последовательных целых. 
Каждое множество $S_r$, $1\le r\le q$, также удовлетворяет условию четности Гейла и состоит из двух элементов. 
Следовательно, для каждого $S_r$ найдется соответствующий столбец в $M_{2, n}$ такой, что
\[
	M_{2,n}(i,S_r)=\prod_{j\in S_r} |j-i|\,.
\]
Теперь определим ячейки матриц $C_1$, \dots, $C_q$ в столбце, индексированном множеством $S$, как $C_r(i,S):=M_{2,n}(i,S_r)$. 
Заметим, что
\[
(C_1 \circ \cdots \circ C_q)(i,S) = \prod_{r = 1}^q \prod_{j \in S_r} |j-i| = \prod_{j \in S} |j-i| = M_{2q,n}(i,S)\,.
\]
	
Несложно проверить, что матрицы $C_1$, \dots, $C_q$ получены из $M_{2,n}$ за счет дублирования, удаления и перестановки столбцов. 
Следовательно, согласно cвойству~\ref{prop:nonneg}, неотрицательный ранг каждой из этих матриц ограничен сверху неотрицательным рангом матрицы $M_{2,n}$. 
Таким образом, согласно лемме~\ref{lem:Kronecker}, матрица невязок $M_{2q, n}$ допускает неотрицательную факторизацию размера $\big(\xc(P_{2,n})\big)^q$.
\end{proof}

%\subsection[Случай d=2q+1]{Случай $\di=2q+1$}


\begin{lemma}\label{lem:odd_case} 
$\xc(P_{2q+1,n}) \le 2 \xc(P_{2q,n-1})$ при $q,n\in\N$, $2q+1 < n$.
\end{lemma}
%
\begin{proof}
Покажем, что $\xc(P_{2q+1, n}(1)) \le \xc(P_{2q, n-1} (2)) + \xc(P_{2q, n-1}(1)) = 2 \xc(P_{2q, n-1})$.
	
Для каждого множества $S\subseteq[n]$, $|S|=2q+1$, удовлетворяющего условию четности Гейла, выполняется ровно одно из двух условий:
%
\begin{enumerate}
	\item \label{case:last_element} $n\in S$ и множество $S\setminus\{n\}$ определяет гипергрань многогранника $P_{2q, n-1}(1)$.
	\item \label{case:first_element} $1\in S$ и множество $S\setminus\{1\}$ определяет гипергрань многогранника $P_{2q, n-1}(2)$.
\end{enumerate}
Разобъем матрицу невязок $M_{2q+1, n}$ на две подматрицы. Подматрица $M_1$ будет состоять из столбцов, удовлетворяющих условию~\ref{case:last_element}, а подматрица $M_2$ "--- из столбцов, удовлетворяющих условию~\ref{case:first_element}.
Согласно свойству~\ref{prop:nonnegsum}, 
\[
\rank_+(M_{2q+1, n}) \le \rank_+(M_1) + \rank_+(M_2).
\]

Прежде всего заметим, что последняя строка матрицы $M_1$ и первая строка матрицы $M_2$ состоят из нулей.
Для $i \in [n-1]$, $i$-я строка матрицы $M_1$ равна $i$-ой строке матрицы $M_{2q, n-1}$, умноженной на положительное число $n-i$.
Таким образом, $\rank_+(M_1) = \rank_+(M_{2q, n-1})$.
Аналогично, при $i \in [2,n]$, $i$-я строка матрицы $M_2$ равна $(i-1)$-ой строке матрицы $M_{2q, n-1}$, умноженной на положительное число $i-1$.
Следовательно, $\rank_+(M_2) = \rank_+(M_{2q, n-1})$.
\end{proof}

Из лемм \ref{lem:two_dim}, \ref{lem:even_case} и \ref{lem:odd_case} следует

\begin{theorem}
\label{thm:main}
$\xc(P_{d,n}) \le 2\bigl(2\lfloor \log_2(n-1)\rfloor+2\bigr)^{\lfloor d/2 \rfloor}$ при $2 \le d < n$.
\end{theorem}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  Алгоритм факторизации матрицы невязок для d=2
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\subsection{Алгоритм явной факторизации матрицы невязок для $d=2$}

В этом разделе описана явная неотрицательная факторизация размера $2\lceil\log(n-1)\rceil+1$ для матрицы невязок $M_{2,n}$. Эта факторизация похожа на ту, что описана в~\cite{Fiorini:2012polygons} для матрицы невязок правильного многоугольника.

Положим $q \coloneq \lceil\log(n-1)\rceil$. Дополнительно определим $q$ чисел $a_1$, \dots, $a_q$ с помощью следующей рекурсивной процедуры (начинаем с $j \coloneq 1$ и $k \coloneq n-1$):
\begin{itemize}
	\item[-] определяем $a_j \coloneq \frac{k}{2}$
	\item[-] обновляем $k \coloneq \lfloor(k+1)/2\rfloor$ и $j \coloneq j+1$ 
	(процедура завершается при $j > q$)
\end{itemize}

Определим неотрицательный вектор $\alpha_i\in\R^{2 \lceil\log(n-1)\rceil}_{+}$ для каждого числа $i\in [1,n]\cap\Z$ с помощью следующей процедуры (начинаем с $j \coloneq 1$ и $x \coloneq i$):
\begin{itemize}
	\item[-] обновляем $r \coloneq x-a_j$
	\item[-] если $r\ge 0$, то $x \coloneq x-2r$ 
	\item[-] если $r\ge 0$, то $\alpha_i(j) \coloneq 2r$ и $\alpha_i(j+1) \coloneq 0$ 
	\item[-] если $r<0$, то $\alpha_i(j) \coloneq 0$ и $\alpha_i(j+1) \coloneq -2r$
	\item[-] обновляем $j \coloneq j+2$ (процедура завершается при $j>2q$).
\end{itemize}
Аналогично, для каждого $S \coloneq \{t,t+1\}$, $t\in [1,n-1]\cap\Z$, определяем неотрицательный вектор $\beta_t\in\R^{2 \lceil\log(n-1)\rceil}_{+}$ с помощью следующей процедуры (начинаем с $j \coloneq 1$ и $y \coloneq t+1$)
\begin{itemize}
	\item[-] обновляем $s \coloneq y-a_j-1/2$
	\item[-] если $s\ge 0$, то $y \coloneq y-2s$ 
	\item[-] если $s\ge 0$, то $\beta_t(j) \coloneq 0$ и $\beta_t(j+1) \coloneq 2s$ 
	\item[-] если $s<0$, то $\beta_t(j) \coloneq -2s$ и $\beta_t(j+1) \coloneq 0$
	\item[-] обновляем $j \coloneq j+2$ (процедура завершается при $j>2q$).
\end{itemize}

Нетрудно проверить, что построенные таким образом вектора задают неотрицательную факторизацию матрицы $M_{2,n}$ с одним удаленным столбцом (соответствующим множеству $S=\{1,n\}$). 
То есть, для каждого $t\in [1,n-1]\cap\Z$ и $i\in [1,n]\cap\Z$,
\begin{equation*}
(i-t)(i-t-1)=\langle\alpha_i, \beta_j\rangle\,.
\end{equation*}
Дополнение этой факторизации до факторизации всей матрицы $M_{2,n}$ не составляет труда. 

С помощью представленного алгоритма для матрицы
\begin{equation*}
\begin{split}
M_{2, 8} & =
\begin{pmatrix}
0	&  2	&  6	& 12	& 20	& 30	& 42	&  0 \\
0	&  0	&  2	&  6	& 12	& 20	& 30	&  6 \\
2	&  0	&  0	&  2	&  6	& 12	& 20	& 10 \\
6	&  2	&  0	&  0	&  2	&  6	& 12	& 12 \\
12	&  6	&  2	&  0	&  0	&  2	&  6	& 12 \\
20	& 12	&  6	&  2	&  0	&  0	&  2	& 10 \\
30	& 20	& 12	&  6	&  2	&  0	&  0	&  6 \\
42	& 30	& 20	& 12	&  6	&  2	&  0	&  0
\end{pmatrix}               
\end{split}
\end{equation*}
получается следующая факторизация размера 7:
\begin{equation*}
M_{2, 8} = 
\begin{pmatrix}
0	& 7	& 0	& 4	& 0	& 2	& 0  \\
0	& 5	& 0	& 2	& 0	& 0	& 6  \\
0	& 3	& 0	& 0	& 2	& 0	& 10 \\
0	& 1	& 2	& 0	& 0	& 0	& 12 \\
1	& 0	& 2	& 0	& 0	& 0	& 12 \\
3	& 0	& 0	& 0	& 2	& 0	& 10 \\
5	& 0	& 0	& 2	& 0	& 0	& 6  \\
7	& 0	& 0	& 4	& 0	& 2	& 0
\end{pmatrix}               
\cdot
\begin{pmatrix}
6	& 4	& 2	& 0	& 0	& 0	& 0	& 0 \\
0	& 0	& 0	& 0	& 2	& 4	& 6	& 0 \\
3	& 1	& 0	& 0	& 0	& 1	& 3	& 0 \\
0	& 0	& 1	& 3	& 1	& 0	& 0	& 0 \\
1	& 0	& 0	& 1	& 0	& 0	& 1	& 0 \\
0	& 1	& 1	& 0	& 1	& 1	& 0	& 0 \\
0	& 0	& 0	& 0	& 0	& 0 & 0	& 1
\end{pmatrix}    \,.
\end{equation*}         


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% End of section
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
