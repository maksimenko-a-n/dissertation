%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%     Аффинная сводимость
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Аффинная сводимость}
\begin{flushright}
Всё познается в сравнении
\end{flushright}


\section{Определения и примеры}

\subsection{Сравнение многогранников}

Как известно, сравнение является одним из наиболее распространенных и универсальных методов исследования.
Чтобы воспользоваться им, введем следующую операцию сравнения,
задающую частичный порядок на множестве всех выпуклых многогранников.

\begin{definition}
В случае, когда многогранник $P$ аффинно эквивалентен многограннику~$Q$ или же его грани, будем использовать обозначение $P \lea Q$.
Факт аффинной эквивалентности многогранников $P$ и $Q$ обозначаем $P =_A Q$.
\end{definition}

В следующей главе будет рассмотрен более мягкий вариант этого определения,
в котором слова <<аффинно эквивалентен>> заменены на <<является аффинным образом>>, а для соответствующего соотношения используется обозначение $\lee$. Там же будет проведен анализ различий в использовании этих двух соотношений при исследовании свойств многогранников.

Нетрудно заметить, что соотношение $\lea$ оказывается особенно полезным
при сравнении комбинаторных свойств (т.\,е. свойств решеток граней) многогранников.

\begin{property}
Если $P \lea Q$, то решетка граней многогранника $P$ 
изоморфна либо всей решетке граней многогранника $Q$ (если $P$ и $Q$ эквивалентны), либо некоторой подрешетке (индуцированной гранью многогранника $Q$), а матрица инциденций гиперграней"=вершин многогранника $P$ является подматрицей матрицы инциденций многогранника $Q$. В частности:
\begin{enumerate}
	\item Число вершин многогранника $P$ не превосходит числа вершин $Q$.
	\item Число $i$-граней многогранника $P$ не превосходит числа $i$-граней $Q$ при $i \le \dim(P)$.
	\item Граф многогранника $P$ оказывается изоморфен некоторому подграфу графа многогранника $Q$.
	\item Число гиперграней $P$ не превосходит числа гиперграней $Q$.
	\item $\rc(P) \le \rc(Q)$.
\end{enumerate}
\end{property}

В качестве примеров перечислим некоторые очевидные соотношения
для симплексов и циклических многогранников.
Прежде всего, симплекс $\Delta_n$ является гранью симплекса $\Delta_{n+1}$, 
а в силу транзитивности соотношения $\lea$ 
получаем 
\begin{equation}
\label{eq:compareDelta}
\Delta_n \lea \Delta_{n+k} \quad \forall n,k \in \N.
\end{equation}
Кроме того, 
\begin{equation}
\label{eq:compareDeltaCP}
\Delta_m \lea \CP_n(S) \quad \text{при } m < n \le |S|, 
\end{equation}
так как циклический многогранник $\CP_n(S)$ симплициален.
По той же причине 
\begin{equation}
\label{eq:compareCP}
\CP_n(S) \nelea \CP_{n+k}(S')
\end{equation}
для всех $n, k \in \N$
и любых множеств $S$ и $S'$, при условии $|S| > n+1 > 2$.

Заметим, что множество симплексов $\Delta = \{\Delta_n\}$ и множество циклических многогранников $\CP = \Set*{\CP_n(S) \given n\in\N, \ S \subset \Q, \ |S| < \infty}$ представляют собой примеры семейств многогранников задач комбинаторной оптимизации.
В связи с этим интерес представляет следующий вопрос.
Какая из двух ситуаций \eqref{eq:compareDelta} или~\eqref{eq:compareCP} является наиболее типичной для известных семейств многогранников задач?
Опыт показывает, что в большинстве случаев легко проверяется справедливость соотношений вида~\eqref{eq:compareDelta}.
При доказательстве такого рода соотношений удобно пользоваться следующим очевидным утверждением.

\begin{lemma}
	\label{lem:01face}
	Пусть $P \in \R^d$ "--- 0/1"~многогранник. Тогда $F_i = \Set*{\bm{x}\in P \given x_i = 0}$ и $G_i = \Set*{\bm{x}\in P \given x_i = 1}$, $i\in[d]$,
	являются гранями (быть может несобственными) многогранника $P$.
\end{lemma}

Рассмотрим три наиболее часто встречающихся в литературе семейства многогранников: булевы квадратичные многогранники $\BQP(n)$, многогранники асимметричной задачи коммивояжера $\ATSP(n)$ и многогранники задачи о рюкзаке $\Knap(n, \bm{a}, b)$.


\begin{prop}
\begin{align*}
\BQP(n) &\lea \BQP(n+1),\\
\ATSP(n) &\lea \ATSP(n+1),\\
\Knap(n, \bm{a}, b) &\lea \Knap(n+1, (\bm{a},0), b), \quad (\bm{a},0) \in \R^{n+1}, \ b\in \R.
\end{align*}
\end{prop}
\begin{proof}
Воспользуемся леммой~\ref{lem:01face}.
Рассмотрим грань $F$ многогранника $\BQP(n+1)$, образованную гиперплоскостью $x_{n+1, n+1} = 0$. 
Тогда для всех $\bm{x} \in F$ выполняется $x_{i, n+1} = 0$ при $i\in[n+1]$.
Нетрудно увидеть, что множество вершин грани $F$ преобразуется в множество вершин многогранника $\BQP(n)$ (и, наоборот, $\BQP(n)$ в $F$) аффинным отображением (ортогональной проекцией) $x_{ij} \mapsto y_{ij}$, $1 \le i \le j \le n$. 

Для доказательства соотношения $\ATSP(n) \lea \ATSP(n+1)$ 
достаточно установить взаимно однозначное соответствие между множеством гамильтоновых контуров полного орграфа $D=(V,A)$ на $n$ вершинах и подмножеством 
гамильтоновых контуров орграфа $D'=(V',A')$ на $n+1$ вершинах, в котором удалены все дуги, входящие в вершину $v'_1$, и дуги, выходящие из $v'_{n+1}$, за исключением дуги $(v'_{n+1}, v'_1)$.
Заметим, что характеристические вектора указанного подмножества контуров оргафа $D'=(V',A')$ являются вершинами грани 
\[F = \Set*{\bm{x} \in \ATSP(n+1) \given x_{(v'_{n+1}, v'_1)} = 1}
\]
многогранника $\ATSP(n+1)$.
Очевидно, грань $F$ и многогранник $\ATSP(n)$ связаны невырожденным аффинным отображением
\[
	y_{(v_i, v_j)} = 
	\begin{cases}
	x_{(v'_i, v'_j)}, & \text{при }1 \le i \le n, \ 2 \le j \le n, \ i \ne j,\\
	x_{(v'_i, v'_{n+1})}, & \text{при }2 \le i \le n, \ j=1,\\
	\end{cases}
\]
где $\bm{x} \in F$, $\bm{y} \in \ATSP(n)$.

Для доказательства соотношения $\Knap(n, \bm{a}, b) \lea \Knap(n+1, (\bm{a},0), b)$ достаточно заметить, что 
\[
\Knap(n+1, (\bm{a},0), b) = \Set*{(\bm{x},x_{n+1}) \in \{0,1\}^{n+1} \given \bm{x} \in \Knap(n, \bm{a}, b)}.
\]
Следовательно, многогранник $\Knap(n, \bm{a}, b)$ аффинно эквивалентен грани многогранника $\Knap(n+1, (\bm{a},0), b)$, образованной гиперплоскостью $x_{n+1} = 0$ (или $x_{n+1} = 1$).
\end{proof}

Соотношение \eqref{eq:compareDeltaCP} является простым примером того, 
что сравнивать можно и многогранники из разных семейств.
Еще одним таким фактом, открытым независимо несколькими авторами~\cite{Deza:2001}, является \emph{ковариантное отображение} $\xi\from \BQP(n) \to \Cut(n+1)$, задаваемое уравнениями
\[
y_{ij} = 
\begin{cases}
x_{ii}, & \text{при } 1 \le i \le n, \ j=n+1,\\
x_{ii} + x_{jj} - 2 x_{ij}, & \text{при } 1 \le i < j \le n.\\
\end{cases}
\]
%где $\bm{x} \in \BQP(n)$, $\bm{y} \in \Cut(n+1)$.
Из невырожденности этого отображения следует
\[
\BQP(n) =_A \Cut(n+1).
\]

Рассмотрим еще два семейства многогранников, ассоциированных с задачами об упаковке и разбиении множества.

Пусть $A\in\{0,1\}^{m\times n}$ "--- матрица инциденций элементов множества $G = \{g_1, \ldots, g_m\}$ и элементов некоторого множества $S = \{S_1, \ldots, S_n\} \subseteq 2^G$.
Выпуклая оболочка множества
\[
\Pack(A) = \Set*{\bm{x}\in\{0,1\}^n \given A \bm{x} \le \bm{1}}
%\quad \text{где } A\in\{0,1\}^{m\times n},
\]
называется \emph{многогранником упаковок множества}~\cite{Balas:1976}.
(Каждая вершина $\bm{x} \in \Pack(A)$ этого многогранника является характеристическим вектором некоторой упаковки $T \subseteq S$.)

Множество вершин \emph{многогранника разбиений множества} определяется по аналогии:
\begin{equation}
\label{eq:Part}
\Part(A) = \Set*{\bm{x}\in\{0,1\}^n \given A \bm{x} = \bm{1}}.
\end{equation}
Непосредственно из определения следует
\begin{equation}
\label{eq:PartPack}
\Part(A) \lea \Pack(A).
\end{equation}

Заметим также, что многогранник независимых множеств $\Stable(G)$ является частным случаем многогранника упаковок множеств:
\begin{equation}
\label{eq:StablePack}
\Stable(G) =_A \Pack(A),
\end{equation}
если $A$ является матрицей инциденций вершин"=ребер графа $G$.

\subsection{Сравнение семейств многогранников}

Прежде, чем перейти к сравнению семейств многогранников, установим еще несколько простых соотношений между $\Stable(G)$, $\Part(A)$, $\Pack(A)$ и $\BQP(n)$.

\begin{lemma}
	\label{lem:PackStable}
	Для любой матрицы $A\in\{0,1\}^{m\times n}$ существует граф $G$ на $n$ вершинах такой, что $\Pack(A) =_A \Stable(G)$.
\end{lemma}

\begin{proof}
	Достаточно заметить, что каждое неравенство вида
	$$
	x_1 + x_2 + \ldots + x_k \le 1
	$$
	из системы $A\bm{x} \le \bm{1}$ при условии $\bm{x}\in \{0,1\}^n$
	эквивалентно набору неравенств
	$$
	x_i + x_j \le 1, \quad 1\le i < j \le k,
	$$
	определяющих множество вершин некоторого многогранника независимых множеств.
\end{proof}

Учитывая соотношение~\eqref{eq:StablePack}, можно сделать вывод о том, что семейства $\{\Pack(A)\}$ и $\{\Stable(G)\}$ идентичны (состоят из одних и тех же многогранников).

\begin{lemma}
	\label{lem:StablePart}
	Для любого графа $G=(V,E)$ существует матрица $A\in\{0,1\}^{m\times n}$, $m = |E|$, $n = |V|+|E|$, такая, что $\Stable(G) =_A \Part(A)$.
\end{lemma}
	
\begin{proof}
	Для каждого неравенства 
	\begin{equation}
		\label{eq:Stable2}
		x_v + x_u \le 1,  \quad \{v,u\} \in E,
	\end{equation}
	из описания многогранника $\Stable(G)$ введем вспомогательную переменную $y_{vu} = 1 - x_v - x_u$.
	Остается заметить, что множество 0/1-векторов, удовлетворяющих неравенствам~\eqref{eq:Stable2}, аффинно эквивалентно множеству 0/1-векторов, удовлетворяющих уравнениям
	\begin{equation*}
		x_v + x_u + y_{vu} = 1,  \quad \{v,u\} \in E.
	\end{equation*}
\end{proof}

Таким образом, согласно соотношению~\eqref{eq:PartPack}, семейство $\{\Part(A)\}$ содержит не только все многогранники семейств $\{\Pack(A)\}$ и $\{\Stable(G)\}$, но и некоторые их грани.

Введем теперь ключевое понятие этой главы "--- аналог полиномиальной сводимости Кука--Карпа--Левина~\cite{Garey:1982} для семейств многогранников.

\begin{definition}
	\label{def:Aff}
	Семейство многогранников $P$ \emph{аффинно сводится} к семейству многогранников $Q$, если для каждого многогранника $p\in P$ найдется $q\in Q$ такой, что $p \lea q$, причем размерность пространства, в котором определен многогранник $q$, ограничена сверху полиномом от размерности пространства, в котором задан $p$.
	Обозначение: $P \propto_A Q$.  
\end{definition}

%Отметим, что это определение отличается от определения аффинной сводимости,
% введенного ранее в монографии \cite{Bondarenko:2008}, 
% в сторону усиления условий.

\begin{remark}
	В определении \ref{def:Aff} важным условием является полиномиальная зависимость размерностей пространств, в~которых определены многогранники, а~не~просто размерностей многогранников. 
	Дело в том, что система ограничений, определяющих многогранник, может оказаться далеко не самым экономным способом его описания. Тем не менее, нашей целью является именно сравнение систем ограничений, или, другими словами, условий задач, ассоциированных с многогранниками.
	
	В качестве примера многогранника с неэкономным описанием можно рассмотреть $\Part(A)$, задаваемый уравнениями
	\[
	x_1 + x_i + x_j = 1, \quad 2 \le i < j \le n.
	\]
	Очевидно, он состоит из одной единственной точки $(1,0,\dots,0)$.
	Вместе с тем, он является гранью многогранника $\Pack(A)$, определяемого неравенствами
	\[
	x_1 + x_i + x_j \le 1, \quad 2 \le i < j \le n,
	\]
	и имеющего размерность $n$.
\end{remark}

На основе выведенных выше соотношений приведем несколько примеров использования обозначения из определения~\ref{def:Aff}.
Так, соотношение \eqref{eq:compareDeltaCP} можно переписать в виде $\Delta \lea \CP$. 
А из лемм \ref{lem:StablePart}, \ref{lem:PackStable} и соотношения 	\eqref{eq:PartPack} следует
 
\begin{theorem}
	\label{thm:Class1}
	$\Stable \propto_A \Part \propto_A \Pack \propto_A \Stable$,
	где $\Stable = \{\Stable(G)\}$, $\Part = \{\Part(A)\}$, $\Pack = \{\Pack(A)\}$.
\end{theorem}

Перечислим некоторые очевидные свойства этого типа сводимости. 

\begin{theorem}
	\label{thm:Prop}
	Пусть $P \propto_A Q$. 
	Предположим, что в семействе $P$ есть многогранники, имеющие одно или несколько из следующих свойств:
	\begin{enumerate}
	\item Cверхполиномиальность (по размерности многогранника) числа вершин или гиперграней.
	\item Cверхполиномиальное кликовое число графа многогранника.
	\item NP-полнота критерия несмежности вершин.
	\item Cверхполиномиальное число прямоугольного покрытия.
	\item Cверхполиномиальная сложность расширения.
	\end{enumerate}
	\noindent
	Тогда в $Q$ имеются многогранники с теми же свойствами.
\end{theorem}

Сравним теперь семейства $\BQP = \{\BQP(n)\}$ и $\Stable$.


\begin{theorem}
	\label{thm:BQPStable}
	Для каждого $n\in \N$ существует граф $G = (V,E)$, $|V| = n(n+1)$, $|E| = n(2n-1)$, такой, что
	$\BQP(n) \lea \Stable(G)$.
\end{theorem}
(Похожий результат получен в~\cite{FioriniPokutta:2015}, но с более слабым соотношением $\lee$ и при $|V| = 2 n^2$. Кроме того, представленное ниже доказательство значительно проще изложенного в~\cite{FioriniPokutta:2015}.)

\begin{proof}
	Каждое равенство $x_{ij} = x_{ii} x_{jj}$ из уравнения~\eqref{eq:BQP}, определяющего булев квадратичный многогранник, эквивалентно неравенствам
	\begin{equation}
	\label{eq:Clique}
	\begin{aligned}
	x_{ii} - x_{ij} &\ge 0, \\
	x_{jj} - x_{ij} &\ge 0, \\
	x_{ii} + x_{jj} - x_{ij} &\le 1,
	\end{aligned}
	\end{equation}
	при условии $x_{ij}\in\{0, 1\}$, $1\le i \le j \le n$.
	Остается преобразовать их в систему неравенств вида $y_l + y_m \le 1$. %из~\eqref{SSP}.
	Для этого введем $n(n+1)$ новых 0/1-переменных:
	\begin{equation}
	\label{eq:BQP2SSP}
	\begin{aligned}
	s_{ij} &= x_{ij},           & 1 &\le i  <  j \le n,\\
	t_{ij} &= x_{ii} - x_{ij},  & 1 &\le i  <  j \le n,\\
	u_i    &= x_{ii},           & 1 &\le i \le n,\\
	\bar{u}_i    &= 1 - x_{ii}, & 1 &\le i \le n.\\
	\end{aligned}
	\end{equation}
	Тогда ограничения~\eqref{eq:Clique} эквивалентны
	%\begin{equation}\label{eq:SSP2}
	$$
	\begin{aligned}
	s_{ij} + \bar{u}_j & \le 1, \\
	t_{ij} + u_j       & \le 1, \\
	u_i    + \bar{u}_i & =   1, \\
	s_{ij} + t_{ij} + \bar{u}_i & = 1,
	\end{aligned}
	$$
	%\end{equation}
	при условии целочисленности всех переменных.
	Очевидно, последние два равенства (точнее, $n(n+1)/2$ подобных равенств)
	определяют некоторую грань многогранника $\Stable(G)$, где число вершин графа $G$ равно $n(n+1)$, а $n (2n - 1)$ его ребер определяют систему неравенств
	%\begin{equation}\label{eq:SSP2}
	$$
	\begin{aligned}
	s_{ij} + \bar{u}_j & \le 1, \\
	t_{ij} + u_j       & \le 1, \\
	u_i    + \bar{u}_i & \le 1, \\
	%   s_{ij} + t_{ij}    & \le 1, \\
	s_{ij} + \bar{u}_i & \le 1, \\
	t_{ij} + \bar{u}_i & \le 1.
	\end{aligned}
	$$
	%\end{equation}
	Более того, соотношения~\eqref{eq:BQP2SSP} связывают эту грань с многогранником $\BQP(n)$ невырожденным аффинным отображением.
\end{proof}

\begin{prop}
	\label{prop:StableBQP}
	Если граф $G=(V,E)$ неполный, то соотношение $\Stable(G) \lea \BQP(n)$ не возможно ни при каком $n$.
\end{prop}

\begin{proof}
Прежде всего заметим, что в множество вершин $\Stable(G)$ всегда входят вектора $\bm{0}$, $\bm{e_1}$, \dots, $\bm{e_d}$, где $d=|V|$.
Если граф $G=(V,E)$ неполный, то $\Stable(G)$ кроме <<обязательных>> векторов содержит еще как минимум один 0/1"~вектор. Пусть $\bm{x}$ "--- один из таких (необязательных) векторов. Легко заметить, что вершины $\bm{0}$ и $\bm{x}$ многогранника $\Stable(G)$ несмежны, так как соединяющий их отрезок пересекается с выпуклой оболочкой вершин $\bm{e_1}$, \dots, $\bm{e_d}$.
Следовательно, многогранник $\Stable(G)$ не является 2"~смежностным.
Остается заметить, что многогранник $\BQP(n)$ (а вместе с ним и его грани) является 2"~смежностным~\cite{Padberg:1989}.
\end{proof}

\section{Многогранники покрытий и двойных покрытий}

По аналогии с многогранниками упаковок и разбиений множества,
\emph{многогранником покрытий множества} называется выпуклая оболочка множества
\[
\Cover(M) = \Set*{\bm{x}\in\{0,1\}^n \given M \bm{x} \ge \bm{1}},
\quad \text{где } M\in\{0,1\}^{m\times n}.
\]

\emph{Многогранником двойных покрытий} будем называть выпуклую оболочку множества
\[
\DCP(B) =  \Set*{\bm{x}\in\{0,1\}^n \given B \bm{x} = \bm{2}},
\]
где $B \in \{0,1\}^{m\times n}$, причем каждая строка матрицы $B$ содержит ровно четыре единицы.
По-видимому, впервые это семейство многогранников было рассмотрено Мацуи~\cite{Matsui:1995}.
Им же была установлена связь между многогранниками покрытий и двойных покрытий.

\begin{theorem}[Мацуи {\cite[theorem 4.3]{Matsui:1995}}]
Для каждой матрицы $B \in \{0,1\}^{m\times n}$ с четырьмя единицами в каждой строке несложно описать матрицу $M \in \{0,1\}^{4m\times n}$ с тремя единицами в каждой строке, что $\DCP(B) \lea \Cover(M)$.
\end{theorem}

Известно также, что задача проверки несмежности вершин для многогранников двойных покрытий NP-полна~\cite{Matsui:1995}.
Точнее, она NP-полна для некоторого подсемейства семейства $\DCP$, о котором пойдет речь ниже.
С целью упрощения обсуждения свойств этого подсемейства, мы приведем более удобное его описание, чем в первоисточнике~\cite{Matsui:1995}.

Прежде всего отметим, что вопрос <<Содержит ли многогранник разбиений $\Part(A)$ хотя бы одну точку?>> является NP-полной задачей даже если все строки матрицы $A$ содержат ровно три единицы~\cite{Matsui:1995,Garey:1982}.
С каждым многогранником $\Part(A)$, $A \in \{0,1\}^{m\times n}$, удовлетворяющим этому условию, свяжем многогранник, множество вершин $\NPadj(A) \subset \{0,1\}^{3n+3}$ которого определим следующим образом.
Для трех координат вектора $\bm{x} \in \NPadj(A)$ введем особые обозначения $y_1, y_2, y_3$. 
Каждой координате $z_j$ вектора $\bm{z} = (z_1,\dots,z_n) \in \Part(A)$ будут соответствовать три координаты $x_j$, $\bar{x}_j$ и $x'_j$ вектора $\bm{x} \in \NPadj(A)$, и два ограничения
\begin{align}
x_j + \bar{x}_j &= 1, \label{eq:adj01}\\
y_1 + y_2 + x'_j + \bar{x}_j&= 2. \notag
\end{align}
А для каждого ограничения вида $z_i + z_j + z_k = 1$ из описания $\Part(A)$
(случай, когда $A$ не содержит ни одной строки, исключаем из рассмотрения)
добавим к описанию множества $\NPadj(A)$ уравнение
\[
y_3 + x_i + x'_j + x'_k = 2.
\]


Заменяя каждое уравнение~\eqref{eq:adj01} в описании многогранника $\NPadj(A)$ на 
\[
a + b + x_j + \bar{x}_j = 2, \quad a = 0, \quad b = 1,
\]
приходим к следующему выводу.

\begin{prop}
Для каждой матрицы $A \in \{0,1\}^{m\times n}$, имеющей ровно три единицы в каждой строке, несложно описать матрицу $B \in \{0,1\}^{(2n+m)\times(3n+5)}$,
что $\NPadj(A) \lea \DCP(B)$.
\end{prop}	


Заметим теперь, что ограничения 
\[
y_1 = 0, \quad y_2 = 1, \quad y_3 = 1,
\]
определяют грань многогранника $\NPadj(A)$, аффинно эквивалентную многограннику $\Part(A)$.
Таким образом,
\begin{equation}\label{eq:PartNPadj}
\Part(A) \lea \NPadj(A).
\end{equation}	
То же самое верно и для следующих наборов ограничений:
\begin{enumerate}
\item[1)] $y_1 = 1$, $y_2 = 0$, $y_3 = 1$;
\item[2)] $y_1 = 0$, $y_2 = 1$, $y_3 = 0$;
\item[3)] $y_1 = 1$, $y_2 = 0$, $y_3 = 0$.
\end{enumerate}
Обозначим эти грани (точнее, множества их вершин) $F_1$, $F_2$, $F_3$, $F_4$, в порядке упоминания.
Заметим, что все четыре грани не имеют общих точек.
Кроме того,
\[
F_4 = \Set*{\bm{1} - \bm{x} \given \bm{x} \in F_1}, \qquad
F_3 = \Set*{\bm{1} - \bm{x} \given \bm{x} \in F_2}.
\]

Ограничениям
\[
y_1 = y_2 = 0
\]
удовлетворяет ровно одна вершина многогранника $\NPadj(A)$, имеющая координаты
$x'_j = \bar{x}_j = 1$, $y_3 = x_j = 0$, $j\in[n]$.
Обозначим эту вершину $\bm{x^0}$.
Аналогично, если 
\[
y_1 = y_2 = 1,
\]
то $x'_j = \bar{x}_j = 0$, $y_3 = x_j = 1$, $j\in[n]$.
Обозначим эту вершину $\bm{\bar{x}^0}$.
Очевидно, $\bm{\bar{x}^0} = \bm{1} - \bm{x^0}$.

Из приведенных выше рассуждений следует, что 
\[
\NPadj(A) = F_1 \cup F_2 \cup F_3 \cup F_4 \cup \{\bm{x^0}, \bm{\bar{x}^0}\},
\]
причем все пять множеств не пересекаются.
Кроме того, вершины $\bm{x^0}$ и $\bm{\bar{x}^0}$ смежны тогда и только тогда, когда $F_1 = \emptyset$ (в противном случае $\conv\{F_1 \cup F_4\}$ и $\conv\{\bm{x^0}, \bm{\bar{x}^0}\}$ имеют общую точку $\bm{1}/2$).
Таким образом, в силу того, что $F_1$ аффинно эквивалентна $\Part(A)$, приходим к следующему выводу.

\begin{theorem}[Мацуи {\cite[theorem 4.1]{Matsui:1995}}]
Задача проверки несмежности вершин $\bm{x^0}$ и $\bm{\bar{x}^0}$ многогранника $\NPadj(A)$ NP-полна.
\end{theorem}
\begin{corollary}
Для семейств многогранников покрытий $\Cover$ и двойных покрытий $\DCP$ задача проверки несмежности вершин NP-полна.
\end{corollary}	

Как известно~\cite{Ikura:1985,Chvatal:1975}, многогранники $\Part(A)$ имеют простой критерий проверки смежности вершин.
Соответственно, в предположении $\NP \ne \textup{P}$ аффинная сводимость $\NPadj \propto_A \Part$ невозможна.
Покажем, что последнее верно и без указанного предположения.

\begin{theorem}\label{thm:DCPStable}
	Если многогранник $\NPadj(A)$ не является отрезком, то $\NPadj(A) \lea \Stable(G)$ невозможно ни для какого графа $G$.
\end{theorem}

\begin{proof}
Как было замечено выше, многогранник $\NPadj(A)$ обязательно содержит пару вершин $\bm{x^0}$ и $\bm{\bar{x}^0}$, и некоторое количество 
четверок вершин вида $\bm{x^{2i-1}} \in F_1$, $\bm{\bar{x}^{2i-1}} \in F_4$, $\bm{x^{2i}} \in F_2$, $\bm{\bar{x}^{2i}} \in F_3$, $i\in [k]$, $k \ge 1$.
Причем
\begin{equation}
\label{3xpairs}
	\bm{x^0} + \bm{\bar{x}^0} = \bm{x^{2i-1}} + \bm{\bar{x}^{2i-1}} = \bm{x^{2i}} + \bm{\bar{x}^{2i}}.
\end{equation}

Предположим, что $\NPadj(A)$ аффинно эквивалентен некоторой грани 
\[
H = \{\bm{y^0}, \bm{\bar{y}^0}, \ldots, \bm{y^{2k}} + \bm{\bar{y}^{2k}}\}
\] 
многогранника $\Stable(G)$ для некоторого графа $G = (V,E)$.
Очевидно, вершины этой грани должны наследовать свойство~\eqref{3xpairs}:
\begin{equation}
\label{3pairs}
	\bm{y^0} + \bm{\bar{y}^0} = \bm{y^{2i-1}} + \bm{\bar{y}^{2i-1}} = \bm{y^{2i}} + \bm{\bar{y}^{2i}}.
\end{equation}
Покажем, что в многограннике $\Stable(G)$ есть еще пара вершин $\bm{y^*}$ и $\bm{\bar{y}^*}$, для которых
\begin{equation}
\label{ThGoal}
\bm{y^*} + \bm{\bar{y}^*} = \bm{y^0} + \bm{\bar{y}^0}.
\end{equation}
Это будет означать, что пересечение $\conv\{\bm{y^*}, \bm{\bar{y}^*}\}$ и $\conv(H)$ не пусто.
То есть $H$ не является гранью $\Stable(G)$.

\begin{figure}
	\[
	\begin{aligned}
	\bm{y^0}&=(\overbrace{\text{\texttt{1,0,1,1,}}}^{I}
	\overbrace{\text{\texttt{0,0,0,0,1,1,1}}}^{J})\\[-1.3ex]
	&\phantom{=(\text{\texttt{1,0,1,1, }}}^{j_0} \\[-2.5ex]
	\bm{\bar{y}^0}&=(\text{\texttt{1,0,1,1,}}
\underbrace{\text{\texttt{1,1,1,1,}}}_{U_0}\!
	\underbrace{\text{\texttt{0,0,0}}}_{\bar{U}_0})
	\end{aligned}
	\]
	\caption{Множества индексов $I$, $J$, $U_0$, $\bar{U}_0$.}
	\label{fig:IJU}
\end{figure}

Пусть $\bm{y^0} = (y^0_1, \ldots, y^0_m)$ и $\bm{\bar{y}^0} = (\bar{y}^0_1, \ldots, \bar{y}^0_m)$, где $m$ "--- число вершин графа $G$.
Рассмотрим множество
\[
I = \Set*{i\in [m] \given y^0_i = \bar{y}^0_i}.
\]
Так как каждая вершина в $\Stable(G)$ является 0/1-вектором, то из~\eqref{3pairs} и~\eqref{ThGoal} следует
\begin{equation}
\label{eq:8}
y^*_i + \bar{y}^*_i = y^0_i = \bar{y}^0_i = \cdots = y^{2k}_i = \bar{y}^{2k}_i  \quad \text{ при } i\in I.
\end{equation}
Далее будем рассматривать только те координаты, значения которых различны для каждой пары вершин (см. рис.~\ref{fig:IJU}):
\[
J = \Set*{j\in [m] \given y^0_i + \bar{y}^0_i = 1} = [m] \setminus I.
\]
Очевидно, $J \ne \emptyset$.

Зафиксируем какой нибудь индекс $j_0 \in J$ и для каждого $i \in \{0,1,\dots, 2k\}$ определим множество
\[
U_i =\begin{cases}
\Set*{j\in J \given y^i_j = 1},& \text{если } y^i_{j_0} = 1,\\
\Set*{j\in J \given \bar{y}^i_j = 1},& \text{иначе},
\end{cases} 
\]
По построению все эти множества попарно различны и $j_0 \in U_i$ (см. рис.~\ref{fig:IJU}).
Для каждого $U_i$ рассмотрим его дополнение $\bar{U}_i = J \setminus U_i$.
Согласно данному определению, для любого $i \in \{0,1,\dots, 2k\}$ и для любых $p,r \in U_i$ (а также для любых $p,r \in \bar{U}_i$) найдется вершина $\bm{y} \in H$ такая, что $y_p = y_r = 1$. 
То есть неравенство $y_p + y_r \le 1$ отсутствует в описании многогранника $\Stable(G)$.

Введем в рассмотрение множество
\[
S = S(i,j,t) = U_i \symdiff U_j \symdiff U_t, \quad 0\le i < j < t \le 2k,
\]
Покажем, что вектор $\bm{y^*}$ с координатами
\[
y^*_i = \begin{cases}
y^0_i,& \text{при } i \in I,\\
1,& \text{при } i \in S,\\
0,& \text{при } i \in J \setminus S,
\end{cases}
\]
и вектор $\bm{\bar{y}^*}$ с координатами
\[
\bar{y}^*_i = \begin{cases}
y^0_i,& \text{при } i \in I,\\
0,& \text{при } i \in S,\\
1,& \text{при } i \in J \setminus S,
\end{cases}
\]
принадлежат $\Stable(G)$.
Для этого достаточно показать, что если вершины грани $H$ удовлетворяют некоторому неравенству вида $y_p + y_r \le 1$ из описания многогранника $\Stable(G)$, то $\bm{y^*}$ и $\bm{\bar{y}^*}$ тоже ему удовлетворяют.

Возможны несколько случаев.

Пусть $p,r\in I$, $p \ne r$.
Так как при $i \in I$ $i$-е координаты вершин грани $H$ и векторов $\bm{y^*}$ и $\bm{\bar{y}^*}$ совпадают, то из того, что неравенство $y_p + y_r \le 1$  выполнено для $H$ следует, что оно также выполнено и для векторов $\bm{y^*}$ и $\bm{\bar{y^*}}$.

Пусть $p \in I$, $r \in J$.
(Случай $r \in I$, $p \in J$ разбирается аналогично.)
Тогда $y^0_r + \bar{y}^0_r = y^*_r + \bar{y}^*_r = 1$.
Следовательно, $\max\{y^*_r, \bar{y}^*_r\} = \max\{y^0_r, \bar{y}^0_r\} = 1$.
И опять из выполнения неравенства $y_p + y_r \le 1$ для $H$ следует, что оно также выполнено для $\bm{y^*}$ и $\bm{\bar{y^*}}$.

Пусть $p \in S$, $r \in J\setminus S$.
(Случай $r \in S$, $p \in J\setminus S$, разбирается аналогично.)
Тогда $y^*_p + y^*_r = \bar{y}^*_p + \bar{y}^*_r = 1$ и требуемое ограничение выполнено.

Пусть $p,r \in S$, $p \ne r$, где $S = S(i,j,t)$.
(Случай $p,r \in J \setminus S$, $p \ne r$, разбирается аналогично.)
Покажем, что в этом случае $p$ и $r$ принадлежат одновременно одному из шести множеств:
$U_i$, $U_j$, $U_t$, $\bar{U}_i$, $\bar{U}_j$, $\bar{U}_t$.
Если это действительно так, то (как было сказано выше при определении этих множеств) неравенство $y_p + y_r \le 1$ отсутствует в описании многогранника $\Stable(G)$.

Итак, предположим, что $p,r \in U_i \symdiff U_j \symdiff U_t$, и покажем, что тогда $p$ и $r$ принадлежат одновременно одному из множеств:
$U_i$, $U_j$, $U_t$, $\bar{U}_i$, $\bar{U}_j$, $\bar{U}_t$.
Заметим, что $U_i \symdiff U_j \symdiff U_t$ представляет собой объединение четырех множеств:
\[
U_i \symdiff U_j \symdiff U_t = (U_i \cap U_j \cap U_t) \cup (U_i \cap \bar{U}_j \cap \bar{U}_t) \cup (\bar{U}_i \cap U_j \cap \bar{U}_t) \cup (\bar{U}_i \cap \bar{U}_j \cap U_t).
\]
Если $p$ и $r$ принадлежат одному из этих четырех множеств, то требуемое условие выполнено.
Нетрудно проверяется, что условие выполнено и в случае, когда $p$ и $r$ принадлежат разным множества.
Например, если $p \in U_i \cap \bar{U}_j \cap \bar{U}_t$, а $r \in \bar{U}_i \cap \bar{U}_j \cap U_t$, то $p,r \in \bar{U}_j$.

Для завершения доказательства остается показать, что найдется тройка индексов $i$, $j$, $t$, $0\le i < j < t \le 2k$, что $S(i,j,t)$ будет отличаться от каждого из множеств $U_p$ и $\bar{U}_p$, $0\le p \le 2k$.

Начнем с простого случая, когда $k=1$.
Нетрудно проверить, что
\[
S(0,1,2) = U_0 \symdiff U_1 \symdiff U_2 \not\in \{U_0, U_1, U_2, \bar{U}_0, \bar{U}_1, \bar{U}_2\},
\]
так как все множества различны и, кроме того, все $U_i$ имеют общий элемент $j_0$:
\[
U_i \symdiff U_j \ne \emptyset \quad \text{и} \quad U_i \symdiff U_j \ne J, \quad \text{при } i\ne j.
\]
	
Предположим теперь, что $k>1$.
Рассмотрим тройки вида 
\[
U_0 \symdiff U_1 \symdiff U_i, \quad 2 \le i \le 2k.
\]
Как было замечено выше,
\[
U_0 \symdiff U_1 \symdiff U_i \not\in \{U_0, U_1, U_i\}.
\]
Кроме того, $U_0 \symdiff U_1 \symdiff U_i \ne \bar{U}_j$ при любом $j \in \{0,1,\dots,2k\}$, так как $j_0 \notin \bar{U}_j$.
Предположим, что 
\begin{equation}
\label{eq:sym-pair}
U_0 \symdiff U_1 \symdiff U_i = U_j
\end{equation}
при некотором $j \in \{2,3,\dots,2k\} \setminus \{i\}$.
Но тогда, в силу свойств симметрической разности (свойство~\ref{prop:symdiff} на с.~\pageref{prop:symdiff})
\[
U_0 \symdiff U_1 \symdiff U_j = U_i.
\]
Причем
\[
U_0 \symdiff U_1 \symdiff U_t \ne U_j, \quad \forall t \ne i.
\]
Иначе $U_t = U_i$, что невозможно по условию.
По тем же соображениям,
\[
U_0 \symdiff U_1 \symdiff U_t \ne U_i, \quad \forall t \ne j.
\]
Таким образом, тройки, для которых выполнено условие \eqref{eq:sym-pair}, разбиваются на пары. 
Но общее число множеств $U_i$, $2 \le i \le 2k$, нечетно.
То есть обязательно найдется множество $U_i$, для которого
$S(0,1,i) = U_0 \symdiff U_1 \symdiff U_i$ будет отличаться от всех остальных.
\end{proof}

Учитывая, что $\NPadj(A)$ является гранью многогранника двойных покрытий, получаем
\begin{corollary}
$\DCP \npropto_A \Stable$ и $\Cover \npropto_A \Stable$.
\end{corollary}	

\section{Многогранники с NP-полным критерием несмежности вершин}

В этом разделе мы рассмотрим несколько семейств многогранников, к которым аффинно сводятся многогранники двойных покрытий.
Как следствие, для всех этих многогранников задача проверки несмежности вершин NP-полна.
Начнем с простых примеров.

Если в описании многогранников задачи о рюкзаке (уравнение~\eqref{eq:KNAP} на с.~\pageref{eq:KNAP}) неравенство заменить равенством, то получим \emph{многогранники задаче о рюкзаке с равенством}:
\begin{equation*}
\KnapEq(\bm{a},b) = \Set*{\bm{x} \in \{0,1\}^{n} \given \bm{a}^T \bm{x} = b}, \qquad \bm{a} \in \Z^n,\quad b \in \Z.
\end{equation*}
Очевидно,
\[
\KnapEq(\bm{a},b) \lea \Knap(\bm{a},b).
\]
Подсемейство многогранников $\KnapEq(\bm{a},b)$, удовлетворяющее условию $2b = \bm{a}^T \bm{1}$, обозначим $\PRT(\bm{a})$.
Оно непосредственно связано с задачей о разбиении чисел, входящей в список из 21 задачи, NP-полнота которых была доказана в фундаментальной работе Карпа~\cite{Karp:1972}.

\begin{theorem}
Для любой матрицы $B \in \{0,1\}^{m\times n}$, имеющей ровно четыре единицы в каждой строке, можно за полиномиальное (от её размера) время построить вектор $\bm{a} \in \Z^n$, $\|\bm{a}\|_{\infty} \le 4^m$,
что $\DCP(B) =_A \PRT(\bm{a})$.
\end{theorem}
\begin{proof}
Достаточно заметить, что система линейных диофантовых уравнений $B \bm{x} = \bm{2}$ может быть агрегирована в одно уравнение (см. \cite{Padberg:1972, Kovalev:1977}).
\end{proof}
\begin{corollary}
Задача проверки несмежности вершин для семейств многогранников $\PRT(\bm{a})$, $\KnapEq(\bm{a},b)$ и $\Knap(\bm{a},b)$ NP-полна.
\end{corollary}
Ранее этот результат об NP-полноте был получен в работах~\cite{Chung:1980,Geist:1992,Matsui:1995} иными методами.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% End of section
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Многогранники задачи коммивояжера}

SAT -> ATSP

Billera Sarangarajan.


\section{Слабая аффинная сводимость}

Определение.
Пусть последовательность конечных множеств $X_n \in \Z^d$, 
где $d = d(n)$ полиномиальна, 
такова, что для любых $n \in \N$ и $x \in \Z^d$
задача проверки принадлежности $x \in X_n$ принадлежит классу NP.
Тогда семейство (последовательность) многогранников $P(n) = \conv(X_n)$
называется \emph{комбинаторным}.

Примечание.
В~\cite{Naddef:1981, MatsuiTamura:1995} комбинаторными называются многогранники, у которых для каждой пары несмежных вершин середина соединяющего их отрезка является также серединой отрезка, соединяющего другую пару вершин этого многогранника.

Лемма.
Пусть семейство многогранников $P(n) \in \Z^d$, $d = d(n)$,  комбинаторно.
Тогда существует комбинаторное семейство многогранников $Q(n) \in \{0,1\}^k$, $k = k(n)$, что
$Q(n)$ является расширением $P(n)$.

Теорема.
Пусть многогранник $P \subseteq \R^d$ является образом многогранника $Q \subseteq \R^n$ при ортогональном проецировании $\pi \from \R^n \to \R^d$, $n > d$.
Пусть, кроме того, $\pi(\ext Q) = \ext P$.
Тогда граф многогранника $P$ является подграфом графа многогранника $Q$.

Доказательство.
Для каждой вершины $\bm{v} \in \ext P$ определим множество
\[
W(\bm{v}) = \Set*{\bm{x} \in \ext Q \given \pi(\bm{x}) = \bm{v}}.
\]
Очевидно, $\conv (W(\bm{v}))$ является гранью многогранника $Q$.

Для удобства полагаем, что $\R^d$ вложено в $\R^n$,
а проецирование $\pi$ преобразует $(x_1, \dots, x_n)$ в $(x_1, \dots, x_d, 0, \dots, 0)$.
Вспомогательный вектор $\bm{c} \in \R^n$ определим следующим образом.
Если $n = d+1$, то $\bm{c} = \bm{e_n}$,
иначе $\bm{c} = \lambda_{d+1} \bm{e_{d+1}} + \dots + \lambda_{n} \bm{e_n}$
и коэффициенты $\lambda_{d+1}$, \dots, $\lambda_{n}$ подобраны так, 
что для любого $\bm{v} \in \ext P$ и любых двух вершин $\bm{w_1}, \bm{w_2} \in W(\bm{v})$ из неравенства $\bm{w_1} \ne \bm{w_2}$ следует $\bm{c}^T \bm{w_1} \ne \bm{c}^T \bm{w_2}$.
Ясно, что в силу конечности множества вершин многогранника $Q$ такой вектор $\bm{c}$ существует. 
С помощью этого вектора в каждом множестве $W(\bm{v})$ выделим уникальную вершину
\[
\bm{w_v} = \argmax_{\bm{w} \in W(\bm{v})} \Set{\bm{c}^T \bm{w}}.
\]

Остается показать, что если вершины $\bm{v_1}$ и $\bm{v_2}$ многогранника $P$ смежны, то соответствующие вершины 
$\bm{w_1} = \bm{w_{v_1}}$ и $\bm{w_2} = \bm{w_{v_2}}$ тоже смежны.

Предположим, что вершины $\bm{v_1}$ и $\bm{v_2}$ многогранника $P$ смежны.
Тогда многогранники $F_1 = \conv (W(\bm{v_1}))$ и $F_2 = \conv (W(\bm{v_2}))$, а также их выпуклая оболочка $F = \conv(F_1 \cup F_2)$ являются гранями многогранника $Q$.
Причем $\aff(F_1)$ и $\aff(F_2)$ ортогональны вектору $\bm{b} = \bm{v_2} - \bm{v_1}$.
(Соответственно, линейная функция $\bm{b}^T \bm{x}$ принимает разные значения для $\bm{w_1}$ и $\bm{w_2}$.)
Подберем числа $\beta, \gamma \in \R$, $\gamma > 0$, так,
чтобы линейная функция $f(\bm{x}) = \beta \bm{b}^T \bm{x} + \gamma \bm{c}^T \bm{x}$ принимала одинаковые значения для $\bm{w_1}$ и $\bm{w_2}$.
Нетрудно проверить, что тогда 
\[
f(\bm{w_1}) = f(\bm{w_2}) > f(\bm{w}) \quad
\text{для всех }
\bm{w} \in W(\bm{v_1}) \cup W(\bm{v_2}) \setminus \{\bm{w_1}, \bm{w_2}\}.
\]
Следовательно, $\bm{w_1}$ и $\bm{w_2}$ смежны.
Доказано.

Следствие.
Пусть многогранник $P \subseteq \R^d$ является образом многогранника $Q \subseteq \R^n$ при аффинном отображении $\pi \from \R^n \to \R^d$.
Пусть, кроме того, $\pi(\ext Q) = \ext P$.
Тогда $\omega(P) \le \omega(Q)$.
